# CyberDemo - Vulnerability Intelligence Command Center - V2

> **Version:** 2.0
> **Estado:** Definicion funcional y de diseno completa
> **Objetivo:** Documento unico de referencia para construir la pagina `/vulnerabilities` y sus subrutas
> **Referencia:** Sigue la estructura de `ATTACK_SURFACE_WOW_DEFINITION.md` (amenazas)

---

## 1) Objetivo del documento

Consolidar en una sola especificacion funcional y de diseno la experiencia completa de gestion de vulnerabilidades de CyberDemo que permita:

- ver, priorizar y gestionar CVEs con contexto de riesgo real (no solo CVSS),
- enriquecer vulnerabilidades con **12+ fuentes** de inteligencia (NVD, EPSS, KEV, ExploitDB, Shodan, SSVC, VulnCheck, OSV, vendor advisories, GitHub Security, Nuclei, Qualys),
- navegar por **4 niveles de detalle anidados** sin dead-ends,
- visualizar el paisaje de vulnerabilidades con efectos "wow" que impresionen a expertos de ciberseguridad,
- operar con decisiones de remediacion basadas en riesgo contextualizado,
- ejecutar acciones directas desde cada vista (parchear, crear ticket, escalar, aceptar riesgo, exportar).

---

## 2) Vision de producto

### 2.1 Nombre funcional

**Vulnerability Intelligence Command Center (Vuln WOW)**

### 2.2 Propuesta de valor

| Dimension            | Antes (CTEMPage actual)         | Despues (Vuln WOW)                                               |
| -------------------- | ------------------------------- | ---------------------------------------------------------------- |
| **Visualizacion**    | Tabla plana con filtros basicos | Terrain 3D, Heatmap Calendar, Sunburst, DNA Helix, Bubble Chart  |
| **Fuentes de datos** | NVD + EPSS (2 fuentes)          | 12+ fuentes con enriquecimiento en cascada                       |
| **Profundidad**      | 1 nivel (lista)                 | 4 niveles anidados (lista -> CVE -> assets -> exploit chain)     |
| **Priorizacion**     | Solo CVSS                       | CVSS + EPSS + KEV + SSVC + Asset Criticality + Exposure          |
| **Acciones**         | Ninguna                         | Patch, Ticket, Escalate, Accept Risk, Export, Playbook           |
| **Contexto**         | CVE aislado                     | CVE + assets afectados + exploits conocidos + actores + campanas |
| **UX**               | Estatico, funcional             | Animaciones, transiciones, efectos operativos con sentido        |

### 2.3 Principios de experiencia

| Principio                  | Significado                                                                             |
| -------------------------- | --------------------------------------------------------------------------------------- |
| **Risk-first**             | Toda priorizacion se basa en riesgo real (EPSS + KEV + asset criticality), no solo CVSS |
| **Evidence-first**         | Cada dato es trazable a fuente, timestamp y nivel de confianza                          |
| **Progressive enrichment** | Se muestra info basica inmediatamente; se enriquece progresivamente                     |
| **No dead ends**           | Desde cualquier CVE se llega a assets, exploits, actores, tickets, y viceversa          |
| **Action-ready**           | Cada vista permite actuar: parchear, crear ticket, escalar, exportar                    |
| **Performance**            | Renderizado < 500ms para 5000+ CVEs; visualizaciones a 60fps                            |

---

## 3) Layout principal

### 3.1 Wireframe maestro

```
+============================================================================+
| HEADER BAR                                                                  |
| [Bug Icon] Vulnerability Intelligence    [Search CVE...] [Presets] [Export]|
+============================================================================+
|        |                                                                    |
| RISK   |                     CANVAS CENTRAL                                 |
| PANEL  |                                                                    |
| (left) |   (Vista A: Risk Terrain | Vista B: Heatmap Calendar              |
|        |    Vista C: Sunburst | Vista D: Bubble Priority                    |
| PRIO   |    Vista E: Exploit DNA | Vista F: Remediation Flow)              |
| ENGINE |                                                                    |
|--------|                    +------------------+                            |
| SSVC:  |                    | Terrain / Heat / |                            |
| [Auto] |                    | Sunburst / Graph |                            |
| [Sched]|                    +------------------+                            |
| [Attend|                                                                    |
| [Track]|                                                    CVE DETAIL     |
|--------|                                                    PANEL          |
| FILTER |                                                    (right, slide)  |
| STACK  |                                                    [CVE-XXXX-YYYY] |
|--------|                                                    [Enrichment]    |
| [KEV]  |                                                    [Assets]        |
| [EPSS] |                                                    [Exploits]      |
| [Patch]|                                                    [Actions]       |
+--------+--------------------------------------------------------------------+
| BOTTOM BAR                                                                  |
| [CVEs:2847 | Crit:89 | KEV:12 | Exploitable:156 | Overdue:34 | SLA:92%]  |
| [Remediation Progress =====[|]==========]  [7d][30d][90d][Custom]          |
+============================================================================+
```

### 3.2 Zonas funcionales

| Zona                 | Posicion                         | Contenido                                                            |
| -------------------- | -------------------------------- | -------------------------------------------------------------------- |
| **Header Bar**       | Top, fija                        | Titulo, buscador CVE/CWE/producto, selector de preset, export global |
| **Risk Panel**       | Left sidebar, colapsable         | Priorizacion SSVC, filtros stack, presets de remediacion             |
| **Canvas Central**   | Centro, todo el espacio restante | Visualizacion activa segun vista seleccionada (6 vistas)             |
| **CVE Detail Panel** | Right sidebar, slide-in          | Aparece al seleccionar CVE; muestra enrichment completo + acciones   |
| **Bottom Bar**       | Bottom, fija                     | KPIs de vulnerabilidades, progress de remediacion, selector temporal |

---

## 4) Vistas visuales (6 modos)

### 4.1 Catalogo de vistas

| Vista | Nombre                 | Icono         | Canvas                                                                                      | Cuando usar                                         |
| ----- | ---------------------- | ------------- | ------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| **A** | Risk Terrain           | mountain      | Paisaje 3D con montanas = CVSS, color = EPSS, fuego = KEV                                   | Vista por defecto. Priorizacion visual inmediata.   |
| **B** | Vulnerability Calendar | calendar-heat | Heatmap tipo GitHub contributions: ejes = semanas x dias, color = severidad acumulada       | Tendencias temporales, ventanas de parcheo.         |
| **C** | CWE Sunburst           | sun           | Anillos concentricos: CWE category -> CWE type -> CVE -> Asset                              | Analisis por tipo de debilidad (Top 25 CWE).        |
| **D** | Priority Bubbles       | circles       | Burbujas: tamano = assets afectados, color = severidad, posicion Y = EPSS, X = dias abierto | Sesion de priorizacion rapida.                      |
| **E** | Exploit DNA Helix      | dna           | Doble helice: CVE vinculados por cadena de explotacion (CWE -> exploit -> tecnica MITRE)    | Analisis de cadenas de ataque via vulnerabilidades. |
| **F** | Remediation Flow       | git-branch    | Sankey/flow diagram: CVE -> triage -> assign -> patch -> verify -> close                    | Gestion de ciclo de vida de remediacion.            |

### 4.2 Conmutacion entre vistas

- Selector en header: tabs con iconos + nombre.
- Transicion animada: morph entre vistas (300ms ease-out).
- Los filtros se preservan al cambiar de vista.
- El CVE Detail Panel se cierra al cambiar de vista (excepto si tiene un CVE pinned).
- Shortcut: `1-6` para cambiar de vista rapidamente.

---

## 5) Sistema de enriquecimiento (12+ fuentes)

### 5.1 Fuentes de enriquecimiento

Este es el corazon del sistema. Cada CVE se enriquece con multiples fuentes en cascada.

#### Fuente 1: NVD (National Vulnerability Database) - YA IMPLEMENTADA

| Propiedad          | Valor                                                                                                    |
| ------------------ | -------------------------------------------------------------------------------------------------------- |
| **Cliente Python** | `clients/nvd_client.py`                                                                                  |
| **Datos**          | cvss_v3_score, cvss_v3_vector, cvss_v2_score, cwe_ids, cpe_uris, references, description, published_date |
| **Rate limit**     | 5 req/30s (sin key), 50 req/30s (con key)                                                                |
| **Enriquece**      | Datos base del CVE, CVSS oficial, CPE (productos afectados), CWE (tipo de debilidad)                     |

#### Fuente 2: EPSS (Exploit Prediction Scoring System) - YA IMPLEMENTADA

| Propiedad          | Valor                                                                             |
| ------------------ | --------------------------------------------------------------------------------- |
| **Cliente Python** | `clients/epss_client.py`                                                          |
| **Datos**          | epss_score (0-1), epss_percentile (0-1)                                           |
| **Rate limit**     | Sin limite                                                                        |
| **Enriquece**      | Probabilidad de explotacion en los proximos 30 dias. Percentil vs todos los CVEs. |

#### Fuente 3: CISA KEV (Known Exploited Vulnerabilities) - NUEVA

| Propiedad          | Valor                                                                                     |
| ------------------ | ----------------------------------------------------------------------------------------- |
| **API**            | `https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json`     |
| **Datos**          | is_kev, date_added, due_date, required_action, known_ransomware_use, notes                |
| **Rate limit**     | JSON estatico, cacheable                                                                  |
| **Enriquece**      | Si CISA ordena parcheo obligatorio. Fecha limite. Uso en ransomware confirmado.           |
| **Impacto visual** | Badge "KEV" rojo pulsante. Efecto fuego en Risk Terrain. Icono llama en todas las vistas. |

#### Fuente 4: ExploitDB / Exploit-DB - NUEVA

| Propiedad          | Valor                                                                                 |
| ------------------ | ------------------------------------------------------------------------------------- |
| **API**            | `https://exploit-db.com/search?cve=CVE-XXXX-YYYY` (scraping) o mirror GitHub          |
| **Datos**          | exploit_id, exploit_type (local/remote/webapps/dos), platform, verified, author, date |
| **Rate limit**     | Moderado (usar cache agresivo)                                                        |
| **Enriquece**      | Exploits publicos disponibles. Tipo de exploit (remoto/local). Si esta verificado.    |
| **Impacto visual** | Icono skull en nodo. Count de exploits como badge rojo.                               |

#### Fuente 5: GitHub Security Advisories (GHSA) - NUEVA

| Propiedad          | Valor                                                                           |
| ------------------ | ------------------------------------------------------------------------------- |
| **API**            | `https://api.github.com/advisories?cve_id=CVE-XXXX-YYYY`                        |
| **Datos**          | ghsa_id, severity, vulnerable_versions, patched_versions, package, ecosystem    |
| **Rate limit**     | 60 req/h (sin token), 5000 req/h (con token)                                    |
| **Enriquece**      | Versiones vulnerables y parcheadas exactas. Ecosistema (npm, pip, maven, etc.). |
| **Impacto visual** | Badge de ecosistema con color por lenguaje. Link directo a advisory.            |

#### Fuente 6: OSV (Open Source Vulnerabilities) - NUEVA

| Propiedad          | Valor                                                                                        |
| ------------------ | -------------------------------------------------------------------------------------------- |
| **API**            | `https://api.osv.dev/v1/vulns/CVE-XXXX-YYYY`                                                 |
| **Datos**          | aliases, affected_packages, ranges (introduced/fixed), database_specific, ecosystem_specific |
| **Rate limit**     | Sin limite                                                                                   |
| **Enriquece**      | Paquetes open source afectados. Commits exactos de introduccion y fix.                       |
| **Impacto visual** | Linea temporal mostrando cuando se introdujo y cuando se fixeo.                              |

#### Fuente 7: VulnCheck KEV+ - NUEVA

| Propiedad          | Valor                                                                                    |
| ------------------ | ---------------------------------------------------------------------------------------- |
| **API**            | `https://api.vulncheck.com/v3/index/vulncheck-kev`                                       |
| **Datos**          | vulncheck_kev_exploits, vulncheck_reported_exploitation, countermeasures, temporal_score |
| **Rate limit**     | API key requerido                                                                        |
| **Enriquece**      | Extension de KEV con mas contexto: exploits reportados, contramedidas, score temporal.   |
| **Impacto visual** | Score temporal animado (gauge con aguja). Contramedidas en tooltip.                      |

#### Fuente 8: Shodan (Internet Exposure) - NUEVA

| Propiedad          | Valor                                                                                                  |
| ------------------ | ------------------------------------------------------------------------------------------------------ |
| **API**            | `https://api.shodan.io/shodan/host/search?query=vuln:CVE-XXXX-YYYY`                                    |
| **Datos**          | internet_exposed_count, countries, organizations, ports, services                                      |
| **Rate limit**     | API key requerido, 1 req/s                                                                             |
| **Enriquece**      | Cuantos sistemas expuestos a internet tienen esta vuln. Paises y organizaciones afectadas globalmente. |
| **Impacto visual** | Mini-mapa mundi con puntos de exposicion. Counter de sistemas expuestos globalmente.                   |

#### Fuente 9: Nuclei Templates - NUEVA

| Propiedad          | Valor                                                                                |
| ------------------ | ------------------------------------------------------------------------------------ |
| **Fuente**         | `https://github.com/projectdiscovery/nuclei-templates` (indexado)                    |
| **Datos**          | has_nuclei_template, template_id, template_severity, template_tags, scanner_verified |
| **Rate limit**     | Indice local cacheable                                                               |
| **Enriquece**      | Si existe un template de scanner automatizado para detectar esta vuln.               |
| **Impacto visual** | Badge "Scannable" verde. Icono radar.                                                |

#### Fuente 10: SSVC (Stakeholder-Specific Vulnerability Categorization) - NUEVA

| Propiedad          | Valor                                                                                                                         |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------- |
| **Calculo**        | Local (algoritmo basado en inputs de otras fuentes)                                                                           |
| **Datos**          | ssvc_decision (Act/Attend/Track/Track\*), exploitation_status, automatable, technical_impact, mission_prevalence              |
| **Inputs**         | EPSS, KEV, exploit availability, asset criticality, exposure                                                                  |
| **Enriquece**      | Decision de remediacion contextualizada: Act (inmediato), Attend (pronto), Track (monitorear), Track\* (monitorear de cerca). |
| **Impacto visual** | Arbol de decision SSVC interactivo. Badge de decision con color (rojo=Act, naranja=Attend, amarillo=Track\*, verde=Track).    |

#### Fuente 11: Vendor Advisories Aggregator - NUEVA

| Propiedad          | Valor                                                                                                  |
| ------------------ | ------------------------------------------------------------------------------------------------------ |
| **Fuentes**        | Microsoft MSRC, Red Hat RHSA, Ubuntu USN, Oracle CPU, Cisco Advisories                                 |
| **Datos**          | vendor_advisory_id, vendor, patch_url, patch_date, workaround, eol_status                              |
| **Rate limit**     | Variado por vendor                                                                                     |
| **Enriquece**      | Parche oficial del vendor. URL directa al parche. Workarounds disponibles. Estado de EOL del producto. |
| **Impacto visual** | Logo del vendor. Badge "Patch Available" o "No Patch". Link directo.                                   |

#### Fuente 12: MITRE ATT&CK (Tecnicas vinculadas) - NUEVA

| Propiedad          | Valor                                                                                |
| ------------------ | ------------------------------------------------------------------------------------ |
| **Fuente**         | Mapping CVE -> CWE -> ATT&CK technique (CAPEC bridge)                                |
| **Datos**          | mitre_techniques, mitre_tactics, attack_complexity, typical_actors                   |
| **Rate limit**     | Mapeo estatico cacheable                                                             |
| **Enriquece**      | Que tecnica de ataque habilita esta vulnerabilidad. Que actores la usan tipicamente. |
| **Impacto visual** | Mini ATT&CK matrix con tecnicas resaltadas. Lineas de conexion en Exploit DNA Helix. |

### 5.2 Pipeline de enriquecimiento

```
CVE detectado
    |
    v
[Nivel 1: Instantaneo (< 100ms)]
    NVD (cache local) + EPSS (cache local) + KEV (cache local)
    |
    v
[Nivel 2: Rapido (< 2s)]
    GitHub Advisories + OSV + Nuclei Index + SSVC (calculo local)
    |
    v
[Nivel 3: Bajo demanda (< 10s)]
    ExploitDB + VulnCheck + Shodan + Vendor Advisories + MITRE ATT&CK
    |
    v
[Resultado: CVE Fully Enriched]
    enrichment_level: "full" | "partial" | "basic"
    enrichment_sources: ["nvd", "epss", "kev", "ghsa", "osv", ...]
    last_enriched_at: timestamp
```

### 5.3 Indicador de nivel de enriquecimiento

Cada CVE muestra un indicador visual de cuantas fuentes lo han enriquecido:

```
[===========----] 8/12 sources   (color gradient: red -> yellow -> green)
```

| Nivel   | Fuentes | Color           | Badge     |
| ------- | ------- | --------------- | --------- |
| Basic   | 1-3     | Rojo            | "Basic"   |
| Partial | 4-7     | Amarillo        | "Partial" |
| Rich    | 8-10    | Verde claro     | "Rich"    |
| Full    | 11-12   | Verde brillante | "Full"    |

---

## 6) Modelo de datos funcional

### 6.1 Entidad principal: EnrichedCVE

```python
class EnrichedCVE:
    # --- Core (NVD) ---
    cve_id: str                          # CVE-2024-12345
    title: str                           # "Remote Code Execution in Apache Log4j"
    description: str                     # Descripcion completa
    published_date: datetime
    last_modified_date: datetime

    # --- Scoring ---
    cvss_v3_score: float                 # 0.0 - 10.0
    cvss_v3_vector: str                  # CVSS:3.1/AV:N/AC:L/...
    cvss_v2_score: float | None
    epss_score: float                    # 0.0 - 1.0 (probabilidad de explotacion)
    epss_percentile: float               # 0.0 - 1.0
    risk_score: float                    # 0 - 100 (score compuesto propio)

    # --- Classification ---
    severity: str                        # Critical, High, Medium, Low
    cwe_ids: list[str]                   # ["CWE-502", "CWE-917"]
    cwe_names: list[str]                 # ["Deserialization of Untrusted Data"]
    cpe_uris: list[str]                  # Productos afectados (CPE format)

    # --- KEV (CISA) ---
    is_kev: bool                         # Esta en el catalogo CISA KEV
    kev_date_added: datetime | None
    kev_due_date: datetime | None        # Fecha limite de parcheo
    kev_required_action: str | None
    kev_ransomware_use: bool             # Usado en ransomware confirmado

    # --- Exploit Intelligence ---
    exploit_count: int                   # Total exploits publicos
    exploit_sources: list[ExploitRef]    # ExploitDB, Metasploit, PoC GitHub
    exploit_maturity: str                # "weaponized" | "poc" | "unproven" | "none"
    has_nuclei_template: bool
    nuclei_template_id: str | None

    # --- SSVC Decision ---
    ssvc_decision: str                   # "Act" | "Attend" | "Track*" | "Track"
    ssvc_exploitation: str               # "active" | "poc" | "none"
    ssvc_automatable: bool
    ssvc_technical_impact: str           # "total" | "partial"
    ssvc_mission_prevalence: str         # "essential" | "supportive" | "minimal"

    # --- Open Source Context ---
    affected_packages: list[PackageRef]  # Paquetes OSS afectados
    patched_versions: list[str]
    vulnerable_ranges: list[str]
    ecosystems: list[str]               # ["npm", "pip", "maven"]

    # --- Internet Exposure (Shodan) ---
    shodan_exposed_count: int            # Sistemas expuestos globalmente
    shodan_countries: list[str]
    shodan_top_ports: list[int]

    # --- Vendor Patches ---
    vendor_advisories: list[VendorAdvisory]
    patch_available: bool
    patch_url: str | None
    workaround_available: bool
    product_eol: bool

    # --- ATT&CK Context ---
    mitre_techniques: list[str]          # ["T1190", "T1059.001"]
    mitre_tactics: list[str]             # ["Initial Access", "Execution"]
    typical_actors: list[str]            # ["APT29", "Lazarus"]

    # --- Threat Intel ---
    threat_actors: list[ThreatActorRef]  # Actores que explotan esta CVE
    malware_families: list[str]          # Malware asociado
    campaigns: list[str]                 # Campanas activas
    exploitation_activity: str           # "none" | "low" | "medium" | "high" | "critical"
    trending: bool                       # En tendencia de explotacion

    # --- Asset Impact (local) ---
    affected_asset_count: int
    affected_critical_assets: int
    affected_departments: list[str]

    # --- Lifecycle ---
    remediation_status: str              # open | in_progress | remediated | accepted_risk | false_positive
    assigned_to: str | None
    sla_due_date: datetime | None
    sla_status: str                      # "on_track" | "at_risk" | "overdue"
    ticket_id: str | None

    # --- Enrichment Metadata ---
    enrichment_level: str                # basic | partial | rich | full
    enrichment_sources: list[str]
    last_enriched_at: datetime
```

### 6.2 Entidades relacionadas

```python
class ExploitRef:
    source: str          # "exploitdb" | "metasploit" | "github_poc" | "nuclei"
    exploit_id: str
    title: str
    type: str            # "remote" | "local" | "webapps" | "dos"
    platform: str
    verified: bool
    url: str
    date_published: datetime

class PackageRef:
    ecosystem: str       # "npm" | "pip" | "maven" | "go" | "cargo"
    package_name: str
    vulnerable_versions: str  # "< 2.17.0"
    patched_version: str      # "2.17.0"
    ghsa_id: str | None

class VendorAdvisory:
    vendor: str          # "Microsoft" | "Red Hat" | "Ubuntu" | "Cisco"
    advisory_id: str     # "MSRC-CVE-2024-12345" | "RHSA-2024:1234"
    patch_url: str
    patch_date: datetime
    workaround: str | None
    severity_vendor: str

class ThreatActorRef:
    name: str            # "APT29"
    aliases: list[str]   # ["Cozy Bear", "The Dukes"]
    country: str         # "RU"
    motivation: str      # "espionage" | "financial" | "hacktivism"
    sophistication: str  # "novice" | "intermediate" | "expert" | "innovator"

class AffectedAsset:
    asset_id: str
    hostname: str
    ip: str
    asset_type: str
    criticality: str
    department: str
    installed_version: str
    patched: bool
    last_scanned: datetime
```

### 6.3 Relaciones

```
EnrichedCVE --1:N--> ExploitRef         (exploits publicos)
EnrichedCVE --1:N--> PackageRef         (paquetes OSS afectados)
EnrichedCVE --1:N--> VendorAdvisory     (parches de vendors)
EnrichedCVE --M:N--> AffectedAsset      (assets de la organizacion)
EnrichedCVE --M:N--> MITRE Technique    (tecnicas de ataque)
EnrichedCVE --M:N--> ThreatActorRef     (actores que la usan)
EnrichedCVE --1:1--> SSVC Decision      (decision de remediacion)
CWE Category --1:N--> EnrichedCVE       (clasificacion de debilidad)
```

### 6.4 KPIs globales

| KPI                      | Formula                                   | Actualizacion | Alerta              |
| ------------------------ | ----------------------------------------- | ------------- | ------------------- |
| Total CVEs               | Count all findings                        | 60s           | -                   |
| CVEs Criticas            | cvss >= 9.0                               | 30s           | Flash si sube       |
| KEV Activas              | is_kev=true AND status!=remediated        | 30s           | Glow rojo si > 0    |
| Exploitable (EPSS > 10%) | epss_score > 0.10                         | 60s           | -                   |
| Con Exploit Publico      | exploit_count > 0                         | 60s           | Badge skull         |
| SLA Overdue              | sla_status = "overdue"                    | 30s           | Parpadeo rojo       |
| SLA Compliance %         | (on_track + remediated) / total \* 100    | 60s           | Rojo si < 85%       |
| SSVC "Act" pendientes    | ssvc_decision = "Act" AND status = "open" | 30s           | Borde rojo pulsante |
| Mean Time to Remediate   | avg(remediated_at - discovered_at)        | 300s          | -                   |
| Patch Coverage %         | (patched_assets / total_affected) \* 100  | 60s           | -                   |

---

## 7) Paginas y rutas (4 niveles anidados)

### 7.1 Jerarquia de navegacion

```
/vulnerabilities                          <- Nivel 1: Dashboard + Canvas
    /vulnerabilities/cves/:cveId          <- Nivel 2: Detalle CVE completo
        /vulnerabilities/cves/:cveId/assets     <- Nivel 3: Assets afectados
        /vulnerabilities/cves/:cveId/exploits   <- Nivel 3: Exploits conocidos
        /vulnerabilities/cves/:cveId/chain      <- Nivel 3: Cadena de ataque
    /vulnerabilities/cwes/:cweId          <- Nivel 2: Detalle CWE
    /vulnerabilities/packages/:ecosystem/:name   <- Nivel 2: Paquete vulnerable
    /vulnerabilities/ssvc                 <- Nivel 2: Dashboard SSVC
    /vulnerabilities/remediation          <- Nivel 2: Flujo de remediacion
    /vulnerabilities/trends               <- Nivel 2: Tendencias temporales
```

### 7.2 Nivel 1: Dashboard principal (`/vulnerabilities`)

La pagina principal con Canvas Central + 6 vistas. Mismo layout de seccion 3.

### 7.3 Nivel 2: Detalle CVE (`/vulnerabilities/cves/:cveId`)

Pagina completa de un CVE con toda la informacion enriquecida.

```
+============================================================================+
| <- Back to Vulnerabilities                     CVE-2024-21762    [Actions] |
+============================================================================+
|                                                                            |
| +--- HEADER CARD ---------------------------------------------------+     |
| | Remote Code Execution in FortiOS SSL-VPN                          |     |
| | Published: 2024-02-08  |  Modified: 2024-03-15                    |     |
| |                                                                    |     |
| | CVSS: [9.8 CRITICAL]  EPSS: [97.2%]  KEV: [YES - Due Feb 16]    |     |
| | SSVC: [ACT IMMEDIATELY]                                           |     |
| | Enrichment: [============] 12/12 Full                              |     |
| +--------------------------------------------------------------------+     |
|                                                                            |
| +--- TABS -----------------------------------------------------------+    |
| | [Overview] [Enrichment] [Assets (342)] [Exploits (7)] [Chain]      |    |
| | [Remediation] [Timeline] [Related CVEs]                             |    |
| +--------------------------------------------------------------------+    |
|                                                                            |
| TAB: Overview                                                              |
| +-------------------------+  +---------------------------+                 |
| | DESCRIPTION             |  | RISK RADAR               |                 |
| | A out-of-bounds write   |  |    CVSS                   |                 |
| | vulnerability [CWE-787] |  |   /    \                  |                 |
| | in FortiOS SSL-VPN...   |  | EPSS --- KEV             |                 |
| |                         |  |   \    /                  |                 |
| | CWE: CWE-787            |  |    SSVC                   |                 |
| | (Out-of-bounds Write)   |  |  [Radar chart 5 ejes]    |                 |
| +-------------------------+  +---------------------------+                 |
|                                                                            |
| +--- CVSS VECTOR BREAKDOWN ----------------------------------------+      |
| | AV:N  AC:L  PR:N  UI:N  S:U  C:H  I:H  A:H                     |      |
| | [Barra visual por componente con tooltips]                        |      |
| +------------------------------------------------------------------+      |
|                                                                            |
| +--- ENRICHMENT SOURCES GRID --------------------------------------+      |
| | [NVD: OK]  [EPSS: OK]  [KEV: YES]  [ExploitDB: 3]              |      |
| | [GHSA: 2]  [OSV: OK]   [VulnCheck: OK] [Shodan: 1.2K]          |      |
| | [Nuclei: YES] [SSVC: Act] [Vendor: Fortinet] [ATT&CK: T1190]   |      |
| +------------------------------------------------------------------+      |
|                                                                            |
+============================================================================+
```

### 7.4 Nivel 3: Assets afectados (`/vulnerabilities/cves/:cveId/assets`)

```
+============================================================================+
| <- CVE-2024-21762                       Affected Assets (342)    [Export]  |
+============================================================================+
|                                                                            |
| SUMMARY CARDS                                                              |
| [Servers: 89] [Workstations: 198] [VMs: 55] [Patched: 123 (36%)]        |
|                                                                            |
| ASSET TABLE (sortable, filterable)                                         |
| +------+-------------+------------+--------+--------+----------+--------+|
| | Type | Hostname    | IP         | Dept   | Crit.  | Patched? | Action ||
| +------+-------------+------------+--------+--------+----------+--------+|
| | SRV  | web-prod-01 | 10.0.1.10  | IT     | CRIT   | NO       | [Patch]||
| | WS   | ws-fin-042  | 10.0.12.42 | Finance| HIGH   | NO       | [Patch]||
| | VM   | db-stg-03   | 10.0.5.33  | DevOps | MED    | YES      |   --   ||
| +------+-------------+------------+--------+--------+----------+--------+|
|                                                                            |
| PATCH PROGRESS                                                             |
| [============---------] 36% patched (123/342)                             |
| Estimated completion: 2026-02-28 (at current rate)                        |
|                                                                            |
+============================================================================+
```

### 7.5 Nivel 3: Exploits conocidos (`/vulnerabilities/cves/:cveId/exploits`)

```
+============================================================================+
| <- CVE-2024-21762                       Known Exploits (7)       [Export]  |
+============================================================================+
|                                                                            |
| EXPLOIT MATURITY: [WEAPONIZED]  (Used in active campaigns)                |
|                                                                            |
| +--- EXPLOIT CARDS -------------------------------------------------+     |
| |                                                                    |     |
| | [VERIFIED] ExploitDB #51523                                       |     |
| | "FortiOS SSL-VPN RCE - Pre-auth"                                 |     |
| | Type: Remote  |  Platform: Linux  |  Author: h4x0r              |     |
| | Published: 2024-02-10  |  Source: Exploit-DB                     |     |
| | [View Code] [Copy URL]                                            |     |
| |                                                                    |     |
| | [VERIFIED] Metasploit Module                                      |     |
| | "exploit/linux/http/fortios_sslvpn_rce"                          |     |
| | Rank: Excellent  |  Platform: Linux                              |     |
| | Added: 2024-02-15  |  Source: Rapid7                             |     |
| | [View Module] [Copy Reference]                                    |     |
| |                                                                    |     |
| | [POC] GitHub PoC                                                  |     |
| | "CVE-2024-21762-PoC"  |  Stars: 234  |  Forks: 89               |     |
| | Language: Python  |  Verified: Community                         |     |
| | [View Repo] [Clone]                                               |     |
| |                                                                    |     |
| | [SCANNER] Nuclei Template                                         |     |
| | "fortios-sslvpn-rce.yaml"  |  Severity: Critical                |     |
| | Tags: rce, fortinet, sslvpn                                      |     |
| | [View Template] [Run Scan]                                        |     |
| |                                                                    |     |
| +--------------------------------------------------------------------+    |
|                                                                            |
+============================================================================+
```

### 7.6 Nivel 3: Cadena de ataque (`/vulnerabilities/cves/:cveId/chain`)

```
+============================================================================+
| <- CVE-2024-21762                       Attack Chain Analysis              |
+============================================================================+
|                                                                            |
|  [Interactive Graph: CVE -> CWE -> CAPEC -> ATT&CK -> Actor]             |
|                                                                            |
|  CVE-2024-21762                                                            |
|       |                                                                    |
|       v                                                                    |
|  CWE-787 (Out-of-bounds Write)                                            |
|       |                                                                    |
|       v                                                                    |
|  CAPEC-100 (Overflow Buffers)                                             |
|       |                                                                    |
|       +-------> T1190 (Exploit Public-Facing Application)                 |
|       |              |                                                     |
|       |              +-> APT29 (Cozy Bear)                                |
|       |              +-> Volt Typhoon                                     |
|       |                                                                    |
|       +-------> T1059.001 (PowerShell)                                    |
|                      |                                                     |
|                      +-> Post-exploitation (Lateral Movement)             |
|                                                                            |
|  RELATED CVEs IN CHAIN:                                                    |
|  CVE-2024-21762 -> CVE-2024-21761 -> CVE-2024-23113                      |
|  (Same product, chained exploitation)                                      |
|                                                                            |
+============================================================================+
```

### 7.7 Nivel 2: Dashboard SSVC (`/vulnerabilities/ssvc`)

```
+============================================================================+
| SSVC Decision Dashboard                                                     |
+============================================================================+
|                                                                            |
|  DECISION TREE (interactive)                                               |
|                                                                            |
|  Exploitation? ----+---- Active (KEV/EPSS>70%) ----> Is it automatable?   |
|                    |                                       |               |
|                    +---- PoC available ------------->  +-- Yes --> ACT     |
|                    |                                   |                   |
|                    +---- None -----------------------> +-- No --> ATTEND   |
|                                                                            |
|  DISTRIBUTION:                                                             |
|  [====] Act:       23  (8%)    [Barra roja]                               |
|  [========] Attend: 45 (16%)   [Barra naranja]                            |
|  [===========] Track*: 67 (24%) [Barra amarilla]                          |
|  [==================] Track: 147 (52%) [Barra verde]                      |
|                                                                            |
|  [Click any decision to filter CVE list below]                            |
|                                                                            |
+============================================================================+
```

---

## 8) Diseno visual WOW

### 8.1 Paleta de colores (hereda de Surface WOW + extensiones vuln)

| Elemento            | Color (hex)                       | Uso                 |
| ------------------- | --------------------------------- | ------------------- |
| Fondo principal     | `#0f172a` (slate-900)             | Canvas background   |
| Fondo paneles       | `#1e293b` (slate-800)             | Sidebars, cards     |
| Bordes              | `#334155` (slate-700)             | Separadores         |
| Texto principal     | `#f1f5f9` (slate-100)             | Titulos, datos      |
| Texto secundario    | `#94a3b8` (slate-400)             | Labels, metadata    |
| **Vuln Critical**   | `#dc2626` (red-600)               | CVSS 9+             |
| **Vuln High**       | `#ea580c` (orange-600)            | CVSS 7-8.9          |
| **Vuln Medium**     | `#ca8a04` (yellow-600)            | CVSS 4-6.9          |
| **Vuln Low**        | `#16a34a` (green-600)             | CVSS 0-3.9          |
| **KEV Fuego**       | `#ff4500` -> `#ff8c00` (gradient) | CVEs en CISA KEV    |
| **SSVC Act**        | `#ef4444`                         | Decision inmediata  |
| **SSVC Attend**     | `#f97316`                         | Atencion pronta     |
| **SSVC Track\***    | `#eab308`                         | Monitoreo cercano   |
| **SSVC Track**      | `#22c55e`                         | Monitoreo rutinario |
| **Enrichment glow** | `#06b6d4` (cyan-500)              | Datos enriquecidos  |
| **Exploit skull**   | `#a855f7` (purple-500)            | Exploits publicos   |

### 8.2 Tipografia

- Titulos: `Inter`, semibold, 20px
- Datos: `JetBrains Mono` (CVE-IDs, scores, vectores CVSS)
- Body: `Inter`, 14px
- Badges: `Inter`, 11px, semibold
- Micro-data: `JetBrains Mono`, 10px

### 8.3 Efectos WOW operativos

| Efecto                      | Donde                                | Como                                                                                                                                                              | Por que                                                                                                  |
| --------------------------- | ------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| **Terrain Elevation**       | Vista A: Risk Terrain                | Montanas CSS 3D con perspectiva. Altura = CVSS. Color = EPSS gradient. Cima con fuego si KEV.                                                                     | Priorizacion visual instantanea: las montanas mas altas y rojas son las mas urgentes.                    |
| **Fuego animado**           | CVEs KEV en cualquier vista          | SVG animado con 3 capas de llamas (opacidad 0.3-0.8, duracion 1.5-3s). Particulas ascendentes cada 500ms.                                                         | Llama la atencion inmediata hacia vulnerabilidades que CISA ordena parchear.                             |
| **Radar de riesgo**         | Detalle CVE: Risk Radar Chart        | Chart radar 5 ejes (CVSS, EPSS, KEV, Exploit, Asset Impact) con relleno gradient y glow. Animacion de entrada spiral-in 800ms.                                    | Muestra el perfil de riesgo multidimensional de un solo vistazo.                                         |
| **DNA Helix rotation**      | Vista E: Exploit DNA Helix           | Dos helices SVG rotando con nodos (CVEs) conectados por puentes (CWE->CAPEC->ATT&CK). Scroll vertical recorre la helice.                                          | Visualiza cadenas de vulnerabilidades interconectadas de forma memorable.                                |
| **Heatmap pulse**           | Vista B: Vulnerability Calendar      | Celdas del heatmap con intensidad animada (pulse 2s) para dias con CVEs criticas nuevas. Efecto "latido" en celdas KEV.                                           | Patron temporal de vulnerabilidades visible de un vistazo (como GitHub contributions pero con amenazas). |
| **Bubble collision**        | Vista D: Priority Bubbles            | Burbujas con fisica simulada (d3-force). Gravedad atrae por EPSS score. Colision suave entre burbujas. Click explota burbuja mostrando detalles.                  | Priorizacion interactiva gamificada: las burbujas mas grandes y rojas flotan arriba.                     |
| **Sankey flow**             | Vista F: Remediation Flow            | Flujo animado tipo rio: ancho = volumen de CVEs. Color cambia en cada etapa. Particulas fluyen por los rios mostrando movimiento.                                 | Visualiza el pipeline de remediacion y donde se acumulan los cuellos de botella.                         |
| **Enrichment cascade**      | Al enriquecer un CVE                 | Los badges de fuentes se iluminan en secuencia (Level 1 -> 2 -> 3) con efecto domino, 200ms entre cada uno. Barra de progreso con shimmer.                        | El analista "ve" el enriquecimiento progresivo en tiempo real.                                           |
| **Count-up animado**        | KPIs en Bottom Bar                   | Transicion numerica smooth de valor anterior a nuevo en 600ms con easing. Flash de color si el delta es significativo.                                            | Sensacion de datos vivos, dashboard activo.                                                              |
| **SSVC tree glow**          | Dashboard SSVC                       | Nodos del arbol de decision se iluminan con glow al hover. Path resaltado al seleccionar una decision. Animacion de ramificacion al cargar (branches grow 400ms). | Decision de remediacion como experiencia visual interactiva.                                             |
| **Severity gradient morph** | Transicion entre vistas              | Al cambiar de vista, los elementos (puntos, barras, burbujas) morphean suavemente a su nueva posicion con color transition 300ms.                                 | Continuidad visual entre vistas, sin "saltos" bruscos.                                                   |
| **Exploit skull float**     | CVEs con exploits en cualquier vista | Mini skull icon con animacion float (translateY oscilante 3px, 2s loop). Glow morado en hover.                                                                    | Identifica visualmente CVEs "weaponized" que requieren atencion urgente.                                 |

### 8.4 Interacciones premium

| Interaccion                      | Resultado                                                                                               |
| -------------------------------- | ------------------------------------------------------------------------------------------------------- |
| **Hover CVE (cualquier vista)**  | Tooltip rico: CVE-ID, CVSS, EPSS %, KEV status, SSVC decision, exploit count, asset count. Delay 200ms. |
| **Click CVE**                    | Abre CVE Detail Panel (slide-in desde derecha, 250ms)                                                   |
| **Doble click CVE**              | Navega a pagina de detalle completa (`/vulnerabilities/cves/:id`)                                       |
| **Right-click CVE**              | Context menu: View Detail, Create Ticket, Escalate, Accept Risk, Add to Watchlist, Copy CVE-ID, Export  |
| **Drag en Risk Terrain**         | Rota perspectiva 3D del terreno                                                                         |
| **Scroll en Risk Terrain**       | Zoom in/out con semantic zoom (cluster -> individual -> detailed)                                       |
| **Click celda Calendar**         | Filtra CVEs publicadas ese dia; muestra mini-lista                                                      |
| **Click sector Sunburst**        | Drill-down al siguiente nivel del anillo (CWE cat -> CWE -> CVE -> Asset)                               |
| **Drag burbuja Priority**        | Mover manualmente para reordenar priorizacion (sticky position guardada en localStorage)                |
| **Click nodo DNA Helix**         | Resalta toda la cadena de ataque conectada; dimma el resto                                              |
| **Click etapa Remediation Flow** | Filtra CVEs en esa etapa; muestra estadisticas de la etapa                                              |
| **Ctrl+K**                       | Abre buscador global (busca por CVE-ID, CWE, producto, vendor, actor)                                   |

### 8.5 Zoom semantico (Risk Terrain + Priority Bubbles)

| Nivel           | Nombre    | Que se ve                                                         |
| --------------- | --------- | ----------------------------------------------------------------- |
| **1 (lejano)**  | Landscape | Clusters de montanas/burbujas por CWE category. Counts agregados. |
| **2 (medio)**   | Grouped   | Montanas/burbujas individuales con color y tamano. Sin labels.    |
| **3 (cercano)** | Detailed  | Labels CVE-ID, badges (KEV, exploit, SSVC), tooltips completos.   |

---

## 9) CVE Detail Panel (sidebar derecho)

### 9.1 Estructura del panel

```
+--- CVE DETAIL PANEL (400px) -----+
| [Pin] [Expand] [Close X]        |
| CVE-2024-21762                   |
|----------------------------------|
| RISK PROFILE                     |
| CVSS: [====9.8====] CRITICAL    |
| EPSS: [========97%] Top 3%      |
| KEV:  [YES] Due: Feb 16         |
| SSVC: [ACT IMMEDIATELY]         |
| [Risk Radar mini-chart]         |
|----------------------------------|
| DESCRIPTION                      |
| A out-of-bounds write vuln in    |
| FortiOS SSL-VPN allows remote... |
|----------------------------------|
| ENRICHMENT SOURCES               |
| [NVD][EPSS][KEV][ExDB][GHSA]   |
| [OSV][VChk][Shdn][Nucl][SSVC]  |
| [Vendor][ATT&CK]   12/12 Full  |
|----------------------------------|
| AFFECTED ASSETS (342)            |
| * web-prod-01 (CRITICAL, !patch)|
| * ws-fin-042 (HIGH, !patch)     |
| * db-stg-03 (MEDIUM, patched)   |
| [View all 342 assets ->]        |
|----------------------------------|
| EXPLOITS (7)                     |
| * ExploitDB #51523 (verified)   |
| * Metasploit module (excellent) |
| * 3x GitHub PoC                 |
| [View all 7 exploits ->]        |
|----------------------------------|
| ATTACK CHAIN                     |
| CWE-787 -> T1190 -> APT29      |
| [View chain analysis ->]        |
|----------------------------------|
| VENDOR PATCHES                   |
| Fortinet FG-IR-24-015           |
| Patch: FortiOS 7.4.3+           |
| [Download Patch]                 |
|----------------------------------|
| ACTIONS                          |
| [Create Ticket] [Escalate]      |
| [Accept Risk] [Add Watchlist]   |
| [Export Report]                  |
+----------------------------------+
```

### 9.2 Comportamiento

- Slide-in desde la derecha, 250ms ease-out.
- Se puede expandir a full-width (overlay mode) para ver mas detalle sin navegar.
- Se puede "pinear" para mantenerlo abierto.
- Click en "View all X assets/exploits" navega a la subruta correspondiente.
- Click en "Expand" abre la pagina de detalle completa.
- Las secciones son colapsables (accordion).
- Los links de enrichment sources abren la fuente original en nueva pestana.

---

## 10) Risk Panel (sidebar izquierdo)

### 10.1 Layout

```
+--- RISK PANEL -------------------+
| PRIORITIZATION                   |
|----------------------------------|
| SSVC FILTER                      |
| [x] Act         (23)            |
| [x] Attend      (45)            |
| [ ] Track*      (67)            |
| [ ] Track       (147)           |
|----------------------------------|
| QUICK FILTERS                    |
| [x] KEV Only                    |
| [x] Exploitable (EPSS>10%)     |
| [ ] Has Public Exploit           |
| [ ] Patch Overdue               |
| [ ] No Patch Available          |
| [ ] Ransomware Use              |
|----------------------------------|
| SEVERITY                         |
| [x] Critical    (89)            |
| [x] High        (234)           |
| [ ] Medium      (567)           |
| [ ] Low         (1957)          |
|----------------------------------|
| PRODUCT / VENDOR                 |
| [Search product...]             |
| * Fortinet (23)                 |
| * Apache (18)                   |
| * Microsoft (156)               |
| * Linux Kernel (34)             |
|----------------------------------|
| ECOSYSTEM                        |
| [ ] npm (45)                    |
| [ ] pip (23)                    |
| [ ] maven (67)                  |
| [ ] go (12)                     |
|----------------------------------|
| CWE CATEGORY                    |
| [ ] Injection (CWE-74)   (89)  |
| [ ] Memory (CWE-119)     (67)  |
| [ ] Auth (CWE-287)       (45)  |
| [ ] XSS (CWE-79)         (34)  |
|----------------------------------|
| PRESETS                          |
| [Urgent Triage]                 |
| [Patch Tuesday]                 |
| [Open Source Risk]              |
| [Internet Exposed]              |
| [Compliance Review]             |
|----------------------------------|
| [Reset All] [Save Preset]       |
+----------------------------------+
```

### 10.2 Presets rapidos

| Preset                | Filtros aplicados                         | Caso de uso                           |
| --------------------- | ----------------------------------------- | ------------------------------------- |
| **Urgent Triage**     | SSVC=Act + KEV + EPSS>10%                 | Priorizacion diaria de lo mas urgente |
| **Patch Tuesday**     | vendor=Microsoft + last 7 days            | Revision post-Patch Tuesday           |
| **Open Source Risk**  | ecosystem != empty + exploit available    | Riesgo en dependencias OSS            |
| **Internet Exposed**  | shodan_exposed > 0 + severity >= High     | Vuln con exposicion a internet        |
| **Compliance Review** | SLA overdue + severity >= High            | Revision de compliance SLA            |
| **Zero Day Watch**    | patch_available=false + exploit_count > 0 | Monitoreo de zero-days activos        |

---

## 11) Bottom Bar (KPIs + Remediation Progress)

### 11.1 Layout

```
+============================================================================+
| [CVE:2847] [Crit:89!] [KEV:12!!] [Expl:156] [Over:34!] [SLA:92%] [MTTR:4d]|
| Remediation: [============------] 68%   [7d][30d][90d][All][Custom]        |
+============================================================================+
```

### 11.2 KPIs en vivo

- Cada KPI es clickeable: filtra el canvas por ese criterio.
- KPIs con cambios recientes tienen flash animado (300ms).
- Colores: `!!` = rojo pulsante, `!` = naranja, normal = gris.
- MTTR (Mean Time to Remediate) calculado en tiempo real.

### 11.3 Remediation Progress Bar

- Barra que muestra el progreso global de remediacion.
- Segmentada por colores: verde (remediated), azul (in_progress), gris (open).
- Selector temporal filtra el periodo de analisis.
- Al hover, muestra breakdown detallado por severidad.

---

## 12) Filtros, busqueda y exploracion

### 12.1 Filtros globales

| Filtro               | Tipo de control     | Valores                         |
| -------------------- | ------------------- | ------------------------------- |
| Rango temporal       | Chips + date picker | 7d, 30d, 90d, 1y, custom        |
| Severidad            | Multi-select chips  | critical, high, medium, low     |
| SSVC Decision        | Multi-select chips  | Act, Attend, Track\*, Track     |
| KEV status           | Toggle              | Solo KEV                        |
| EPSS umbral          | Slider              | 0% - 100%                       |
| Exploit availability | Toggle              | Con exploit publico             |
| Patch status         | Multi-select        | available, unavailable, overdue |
| Vendor               | Searchable dropdown | Microsoft, Apache, Fortinet...  |
| CWE Category         | Multi-select        | Injection, Memory, Auth, XSS... |
| Ecosystem            | Multi-select        | npm, pip, maven, go, cargo      |
| SLA status           | Multi-select        | on_track, at_risk, overdue      |
| Enrichment level     | Multi-select        | basic, partial, rich, full      |

### 12.2 Buscador global

- Input siempre visible en header.
- Soporte para: CVE-ID, CWE-ID, producto, vendor, GHSA-ID, paquete npm/pip/maven.
- Autodeteccion de tipo de busqueda.
- Autosuggest con resultados agrupados por tipo.
- Al seleccionar resultado: navega al nodo en canvas y abre Detail Panel.
- Resaltado visual (glow) del nodo encontrado.
- Shortcut: `Ctrl+K` o `/` para enfocar buscador.

### 12.3 Query builder avanzado

- Accesible desde icono junto al buscador.
- Condiciones combinables: AND / OR / NOT.
- Ejemplo: `severity:critical AND kev:true AND epss_score:>0.5 AND vendor:fortinet`.
- Guardado de queries favoritas.
- Presets SOC: "CVEs criticas con exploit en activo VIP", "Zero-days sin parche ultimas 24h".

---

## 13) Backend y endpoints

### 13.1 Endpoints existentes reutilizados

```
GET /ctem/assets/{asset_id}           -> AssetRisk (risk_color, finding_count)
GET /ctem/assets/{asset_id}/findings  -> Findings for asset
GET /ctem/findings                    -> All findings (paginated)
GET /ctem/summary                     -> Severity/exposure/risk distribution
```

### 13.2 Endpoints nuevos necesarios

| Endpoint                                      | Metodo | Descripcion                                        | Response clave                                         |
| --------------------------------------------- | ------ | -------------------------------------------------- | ------------------------------------------------------ |
| `/vulnerabilities/overview`                   | GET    | KPIs agregados para Bottom Bar                     | total, critical, kev, exploitable, overdue, sla%, mttr |
| `/vulnerabilities/enriched`                   | GET    | CVEs enriquecidos con filtros avanzados (paginado) | Lista de EnrichedCVE con todos los campos              |
| `/vulnerabilities/enriched/{cve_id}`          | GET    | Detalle completo de un CVE enriquecido             | EnrichedCVE completo                                   |
| `/vulnerabilities/enriched/{cve_id}/assets`   | GET    | Assets afectados por un CVE                        | Lista de AffectedAsset                                 |
| `/vulnerabilities/enriched/{cve_id}/exploits` | GET    | Exploits conocidos para un CVE                     | Lista de ExploitRef                                    |
| `/vulnerabilities/enriched/{cve_id}/chain`    | GET    | Cadena de ataque (CWE->CAPEC->ATT&CK)              | Grafo de relaciones                                    |
| `/vulnerabilities/enriched/{cve_id}/enrich`   | POST   | Trigger enriquecimiento bajo demanda               | enrichment_level, sources                              |
| `/vulnerabilities/cwes`                       | GET    | Lista de CWEs con stats                            | CWE-ID, name, cve_count, severity_avg                  |
| `/vulnerabilities/cwes/{cwe_id}`              | GET    | Detalle CWE con CVEs                               | CWE info + lista CVEs                                  |
| `/vulnerabilities/ssvc/summary`               | GET    | Distribucion de decisiones SSVC                    | act, attend, track\*, track counts                     |
| `/vulnerabilities/ssvc/tree`                  | GET    | Arbol de decision SSVC con datos                   | Nodos del arbol con counts                             |
| `/vulnerabilities/remediation/stats`          | GET    | Estadisticas de remediacion                        | mttr, sla_compliance, by_stage                         |
| `/vulnerabilities/remediation/flow`           | GET    | Datos para Sankey de remediacion                   | Stages con volumen y transiciones                      |
| `/vulnerabilities/trends`                     | GET    | Tendencias temporales                              | Serie temporal de CVEs por dia/semana                  |
| `/vulnerabilities/packages`                   | GET    | Paquetes vulnerables por ecosistema                | ecosystem, package, vuln_count                         |
| `/vulnerabilities/terrain`                    | GET    | Datos preprocesados para Risk Terrain              | Nodos con posicion, elevacion, color                   |
| `/vulnerabilities/heatmap`                    | GET    | Datos para Calendar Heatmap                        | Matriz semana x dia con counts                         |
| `/vulnerabilities/sunburst`                   | GET    | Datos para CWE Sunburst                            | Arbol jerarquico CWE cat -> CWE -> CVE                 |
| `/vulnerabilities/bubbles`                    | GET    | Datos para Priority Bubbles                        | CVEs con x, y, size, color                             |

### 13.3 Endpoint Enriched CVEs (especificacion detallada)

```
GET /vulnerabilities/enriched?page=1&page_size=50
    &severity=critical,high
    &ssvc=act,attend
    &kev=true
    &epss_min=0.1
    &exploit_available=true
    &patch_status=available,unavailable
    &sla_status=overdue,at_risk
    &vendor=fortinet,microsoft
    &cwe=CWE-787,CWE-79
    &ecosystem=npm,pip
    &enrichment_level=full,rich
    &sort=risk_score:desc
    &time_range=30d

Response:
{
  "total": 89,
  "page": 1,
  "page_size": 50,
  "filters_applied": {...},
  "items": [
    {
      "cve_id": "CVE-2024-21762",
      "title": "FortiOS SSL-VPN RCE",
      "severity": "Critical",
      "cvss_v3_score": 9.8,
      "cvss_v3_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
      "epss_score": 0.972,
      "epss_percentile": 0.997,
      "risk_score": 98.5,
      "is_kev": true,
      "kev_due_date": "2024-02-16T00:00:00Z",
      "kev_ransomware_use": true,
      "exploit_count": 7,
      "exploit_maturity": "weaponized",
      "ssvc_decision": "Act",
      "affected_asset_count": 342,
      "affected_critical_assets": 23,
      "patch_available": true,
      "remediation_status": "in_progress",
      "sla_status": "at_risk",
      "enrichment_level": "full",
      "enrichment_sources": ["nvd","epss","kev","exploitdb","ghsa","osv","vulncheck","shodan","nuclei","ssvc","vendor","mitre"],
      "last_enriched_at": "2026-02-13T10:30:00Z"
    }
  ]
}
```

---

## 14) Generadores Python (extension de gen_ctem.py)

### 14.1 Campos nuevos a generar

El generador existente `gen_ctem.py` genera: finding_id, asset_id, hostname, cve_id, title, product, severity, cvss_score, cvss_vector, remediation_status, discovered_at, exploit_available, patch_available.

Se extiende con los siguientes campos para soportar el enriquecimiento completo:

```python
# Campos nuevos a anadir al finding generado
extended_finding = {
    # --- Existentes (ya en gen_ctem.py) ---
    "finding_id": "FIND-...",
    "asset_id": "ASSET-...",
    "cve_id": "CVE-2024-XXXXX",
    "severity": "Critical",
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/...",
    "remediation_status": "open",
    "exploit_available": True,
    "patch_available": True,

    # --- Nuevos: EPSS ---
    "epss_score": 0.972,
    "epss_percentile": 0.997,

    # --- Nuevos: KEV ---
    "is_kev": True,
    "kev_date_added": "2024-02-09",
    "kev_due_date": "2024-02-16",
    "kev_required_action": "Apply mitigations per vendor instructions",
    "kev_ransomware_use": True,

    # --- Nuevos: Exploit Intelligence ---
    "exploit_count": 7,
    "exploit_maturity": "weaponized",  # weaponized|poc|unproven|none
    "exploit_sources": [
        {"source": "exploitdb", "id": "51523", "verified": True},
        {"source": "metasploit", "id": "exploit/linux/http/fortios_sslvpn_rce", "verified": True},
        {"source": "github_poc", "id": "CVE-2024-21762-PoC", "verified": False},
    ],
    "has_nuclei_template": True,

    # --- Nuevos: SSVC ---
    "ssvc_decision": "Act",
    "ssvc_exploitation": "active",
    "ssvc_automatable": True,
    "ssvc_technical_impact": "total",

    # --- Nuevos: Classification ---
    "cwe_ids": ["CWE-787"],
    "cwe_names": ["Out-of-bounds Write"],
    "cwe_category": "Memory Corruption",

    # --- Nuevos: Package/Ecosystem ---
    "affected_packages": [
        {"ecosystem": "binary", "name": "fortios", "vulnerable_versions": "< 7.4.3"}
    ],

    # --- Nuevos: Internet Exposure ---
    "shodan_exposed_count": 1234,
    "shodan_countries": ["US", "DE", "CN", "JP", "KR"],

    # --- Nuevos: Vendor ---
    "vendor_advisory_id": "FG-IR-24-015",
    "vendor": "Fortinet",
    "patch_url": "https://fortiguard.fortinet.com/...",
    "workaround_available": True,
    "product_eol": False,

    # --- Nuevos: ATT&CK ---
    "mitre_techniques": ["T1190"],
    "mitre_tactics": ["Initial Access"],
    "typical_actors": ["APT29", "Volt Typhoon"],

    # --- Nuevos: Threat Intel ---
    "threat_actors": [
        {"name": "APT29", "country": "RU", "motivation": "espionage"},
    ],
    "malware_families": ["Cobalt Strike"],
    "exploitation_activity": "high",
    "trending": True,

    # --- Nuevos: Risk Score Compuesto ---
    "risk_score": 98.5,

    # --- Nuevos: SLA ---
    "sla_due_date": "2024-02-20",
    "sla_status": "at_risk",

    # --- Nuevos: Enrichment ---
    "enrichment_level": "full",
    "enrichment_sources": ["nvd","epss","kev","exploitdb","ghsa","osv","vulncheck","shodan","nuclei","ssvc","vendor","mitre"],
    "last_enriched_at": "2026-02-13T10:30:00Z",
}
```

### 14.2 Algoritmo de Risk Score compuesto

```python
def calculate_risk_score(finding: dict) -> float:
    """
    Calculate composite risk score (0-100) combining multiple dimensions.

    Weights:
    - CVSS Score (25%): Base severity
    - EPSS Score (25%): Exploit probability
    - KEV Status (15%): CISA mandate
    - Exploit Maturity (15%): Public exploit availability
    - Asset Impact (10%): Criticality of affected assets
    - Exposure (10%): Internet exposure via Shodan
    """
    cvss_component = (finding.get("cvss_score", 0) / 10.0) * 25

    epss_component = finding.get("epss_score", 0) * 25

    kev_component = 15.0 if finding.get("is_kev") else 0.0

    maturity_map = {"weaponized": 15, "poc": 10, "unproven": 3, "none": 0}
    exploit_component = maturity_map.get(finding.get("exploit_maturity", "none"), 0)

    criticality_map = {"critical": 10, "high": 7, "medium": 4, "low": 1}
    asset_component = criticality_map.get(finding.get("asset_criticality", "medium"), 4)

    shodan = finding.get("shodan_exposed_count", 0)
    exposure_component = min(10.0, (shodan / 100.0) * 10)

    return round(
        cvss_component + epss_component + kev_component +
        exploit_component + asset_component + exposure_component,
        1
    )
```

### 14.3 Algoritmo SSVC Decision

```python
def calculate_ssvc_decision(finding: dict) -> str:
    """
    Calculate SSVC decision using simplified decision tree.

    Decision tree:
    1. Is exploitation active? (KEV or EPSS > 70%)
       -> Is it automatable? (AV:N + AC:L + PR:N)
          -> Yes: ACT
          -> No: ATTEND
    2. Is there a PoC? (exploit_count > 0)
       -> Technical impact total? (C:H + I:H + A:H)
          -> Yes: ATTEND
          -> No: TRACK*
    3. No exploitation evidence:
       -> TRACK
    """
    is_active = finding.get("is_kev") or finding.get("epss_score", 0) > 0.7

    if is_active:
        vector = finding.get("cvss_vector", "")
        is_automatable = "AV:N" in vector and "AC:L" in vector and "PR:N" in vector
        return "Act" if is_automatable else "Attend"

    has_poc = finding.get("exploit_count", 0) > 0
    if has_poc:
        vector = finding.get("cvss_vector", "")
        total_impact = "C:H" in vector and "I:H" in vector and "A:H" in vector
        return "Attend" if total_impact else "Track*"

    return "Track"
```

---

## 15) Flujos operativos

### 15.1 Flujo de triage diario de vulnerabilidades

1. Entrar en `/vulnerabilities` (preset "Urgent Triage" activo).
2. Vista A (Risk Terrain) muestra montanas mas altas = CVEs mas urgentes.
3. Bottom Bar muestra KPIs: CVEs criticas, KEV activas, SLA overdue.
4. Las montanas con fuego (KEV) llaman atencion inmediata.
5. Click en montana critica: Detail Panel muestra contexto completo.
6. Revisar SSVC decision: "Act" -> accion inmediata.
7. Click "View assets": ver los 342 servidores afectados.
8. Click "Create Ticket": crear ticket de parcheo con toda la evidencia.
9. Siguiente montana. Repetir.

### 15.2 Flujo de Patch Tuesday

1. Entrar con preset "Patch Tuesday".
2. Cambiar a Vista B (Calendar Heatmap): ver el "heat" del martes pasado.
3. Click en la celda del martes: filtrar las 45 CVEs nuevas de Microsoft.
4. Cambiar a Vista D (Priority Bubbles): priorizar visualmente.
5. Las burbujas mas grandes y rojas primero.
6. Click en cada burbuja: ver assets afectados, crear tickets en batch.
7. Verificar con Vista F (Remediation Flow) que el pipeline no esta saturado.

### 15.3 Flujo de gestion de riesgo OSS

1. Entrar con preset "Open Source Risk".
2. Cambiar a Vista C (CWE Sunburst): ver distribucion por tipo de debilidad.
3. Filtrar por ecosistema: npm, pip.
4. Drill-down en CWE-79 (XSS): ver CVEs en dependencias npm.
5. Click en CVE: ver paquete vulnerable, versiones parcheadas.
6. Click "View package": ver todas las CVEs de ese paquete.
7. Crear tickets para actualizar dependencias.

### 15.4 Flujo de analisis de cadena de ataque

1. Seleccionar una CVE critica con exploit weaponized.
2. Cambiar a Vista E (Exploit DNA Helix).
3. La helice muestra CVEs interconectadas por cadena de explotacion.
4. Click en nodo de la helice: ver cadena completa (CVE -> CWE -> CAPEC -> ATT&CK).
5. Identificar que actores usan esta cadena.
6. Navegar a los assets afectados por toda la cadena.
7. Priorizar parcheo de la CVE que rompe mas cadenas.

### 15.5 Flujo de remediacion y SLA

1. Entrar con preset "Compliance Review".
2. Cambiar a Vista F (Remediation Flow): ver pipeline como Sankey.
3. Identificar cuellos de botella: donde se acumulan CVEs sin avanzar.
4. Click en etapa con acumulacion: ver lista de CVEs bloqueadas.
5. Revisar SLA status en Bottom Bar: 92% compliance.
6. Generar reporte ejecutivo con metricas de remediacion.

---

## 16) Criterios de exito

### 16.1 Funcionalidad

- [ ] 6 vistas visuales conmutables con preservacion de filtros
- [ ] 12+ fuentes de enriquecimiento funcionales (o simuladas con generadores)
- [ ] 4 niveles de navegacion anidada sin dead-ends
- [ ] CVE Detail Panel con toda la info enriquecida
- [ ] Filtros por SSVC, KEV, EPSS, severity, vendor, ecosystem, CWE
- [ ] Buscador por CVE-ID, CWE, producto, vendor
- [ ] Acciones directas: Create Ticket, Escalate, Accept Risk, Export
- [ ] KPIs en vivo con actualizacion periodica
- [ ] Remediation Progress bar funcional

### 16.2 Valor operativo

- [ ] Priorizacion basada en riesgo real (no solo CVSS)
- [ ] Reduccion de tiempo de triage (toda la info en una vista)
- [ ] Cadena de ataque visible para priorizacion estrategica
- [ ] Contexto completo de un CVE en < 3 clicks
- [ ] SLA tracking automatico

### 16.3 Efecto WOW

- [ ] Risk Terrain con montanas 3D y fuego en KEV: impresion visual inmediata
- [ ] DNA Helix con cadenas de explotacion: "nunca he visto esto"
- [ ] Calendar Heatmap con pulso en dias criticos: patron temporal visible
- [ ] Priority Bubbles con fisica: priorizacion gamificada
- [ ] Enrichment cascade: enriquecimiento visible en tiempo real
- [ ] Radar de riesgo multidimensional: perfil de un vistazo
- [ ] Sankey de remediacion: pipeline visible con cuellos de botella

### 16.4 Performance

- [ ] Canvas fluido (60fps) con 5000+ CVEs
- [ ] Cambio de vista en < 500ms
- [ ] Enrichment Level 1 en < 100ms
- [ ] Enrichment Level 2 en < 2s
- [ ] Filtros en < 300ms
- [ ] Detail Panel en < 200ms

---

## 17) Estado actual vs objetivo

### 17.1 Ya disponible (base util)

| Componente         | Estado    | Archivos                                                                                                                          |
| ------------------ | --------- | --------------------------------------------------------------------------------------------------------------------------------- |
| Generador CTEM     | Funcional | `gen_ctem.py` (439 LOC) - genera CVE findings con cvss_score, cvss_vector, remediation_status, exploit_available, patch_available |
| API CTEM           | Funcional | `api/ctem.py` (191 LOC) - endpoints para assets, findings, summary                                                                |
| Cliente NVD        | Funcional | `clients/nvd_client.py` (297 LOC) - fetch CVE data, CVSS, CWE, CPE, references                                                    |
| Cliente EPSS       | Funcional | `clients/epss_client.py` (172 LOC) - fetch exploit probability scores                                                             |
| Cliente AbuseIPDB  | Funcional | `clients/abuseipdb_client.py` - IP reputation                                                                                     |
| Cliente GreyNoise  | Funcional | `clients/greynoise_client.py` - internet noise classification                                                                     |
| Cliente OTX        | Funcional | `clients/otx_client.py` - AlienVault threat intel                                                                                 |
| Pagina CTEM        | Funcional | `CTEMPage.tsx` (398 LOC) - tabla con severity, CVSS, EPSS, risk_score, threat_actors, exposure                                    |
| Tipos CTEM         | Funcional | `types/index.ts` (CTEMFinding)                                                                                                    |
| OpenSearch indices | Funcional | ctem-asset-risk-v1, ctem-findings-v1                                                                                              |

### 17.2 Gap a cerrar

| Gap                                               | Esfuerzo | Prioridad |
| ------------------------------------------------- | -------- | --------- |
| Extender generador con campos enrichment          | Medio    | Alta      |
| 10 nuevos clientes de enriquecimiento (simulados) | Medio    | Alta      |
| Algoritmo Risk Score compuesto                    | Bajo     | Alta      |
| Algoritmo SSVC Decision                           | Bajo     | Alta      |
| 18 endpoints nuevos                               | Alto     | Alta      |
| Vista A: Risk Terrain (CSS 3D + Canvas)           | Alto     | Alta      |
| Vista B: Calendar Heatmap                         | Medio    | Media     |
| Vista C: CWE Sunburst (D3.js)                     | Medio    | Media     |
| Vista D: Priority Bubbles (D3-force)              | Medio    | Alta      |
| Vista E: Exploit DNA Helix                        | Alto     | Media     |
| Vista F: Remediation Flow (Sankey)                | Medio    | Media     |
| CVE Detail Panel completo                         | Medio    | Alta      |
| Risk Panel con filtros SSVC                       | Medio    | Alta      |
| Bottom Bar con KPIs + progress                    | Bajo     | Alta      |
| 4 niveles de paginas anidadas                     | Medio    | Alta      |
| Efectos WOW (fuego, glow, animations)             | Medio    | Alta      |
| Buscador global CVE                               | Bajo     | Media     |
| Presets de filtrado                               | Bajo     | Media     |
| Acciones (ticket, escalate, export)               | Medio    | Media     |

### 17.3 Stack tecnologico recomendado para visualizaciones

| Vista            | Libreria                       | Por que                                              |
| ---------------- | ------------------------------ | ---------------------------------------------------- |
| Risk Terrain     | CSS 3D transforms + Canvas API | Performance con 5000+ elementos, efecto 3D sin WebGL |
| Calendar Heatmap | D3.js cal-heatmap              | Standard para heatmaps tipo GitHub                   |
| CWE Sunburst     | D3.js sunburst                 | Jerarquia multi-nivel nativa                         |
| Priority Bubbles | D3-force simulation            | Fisica realista de burbujas                          |
| DNA Helix        | SVG + CSS animations           | Control preciso de la helice                         |
| Remediation Flow | D3-sankey                      | Standard para diagramas de flujo                     |
| Risk Radar       | Chart.js radar                 | Simple y efectivo                                    |
| Efectos fuego    | CSS animations + SVG           | Lightweight, no canvas adicional                     |

---

## 18) Resultado esperado

Un **Vulnerability Intelligence Command Center** que:

1. **Multiplica el valor** del CTEMPage actual de una tabla basica a un sistema de 6 vistas interactivas con 12+ fuentes de enriquecimiento.

2. **Produce impacto visual** con efectos como Risk Terrain con montanas y fuego, DNA Helix de cadenas de explotacion, y Priority Bubbles con fisica simulada.

3. **Entrega valor operativo real** con priorizacion SSVC (no solo CVSS), tracking de SLA, cadenas de ataque, y contexto completo de cada CVE en 4 niveles de drill-down.

4. **Aprovecha lo existente**: reutiliza `gen_ctem.py`, `ctem.py`, `nvd_client.py`, `epss_client.py`, y `CTEMPage.tsx` como base para extender.

5. **Impresiona a expertos**: visualizaciones que un CISO o analista SOC senior no ha visto antes, con sentido operativo real (no solo estetica).

### Comparativa de impacto visual: Amenazas vs Vulnerabilidades

| Dimension               | Surface WOW (Amenazas)                                       | Vuln WOW (Vulnerabilidades)                                                                             |
| ----------------------- | ------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------- |
| Modos visuales          | 5 (Surface, Graph, Landscape, Map, Timeline)                 | 6 (Terrain, Calendar, Sunburst, Bubbles, DNA, Sankey)                                                   |
| Fuentes enriquecimiento | 5 (AbuseIPDB, EPSS, GreyNoise, NVD, OTX)                     | 12 (NVD, EPSS, KEV, ExploitDB, GHSA, OSV, VulnCheck, Shodan, Nuclei, SSVC, Vendor, ATT&CK)              |
| Niveles navegacion      | 2 (lista + detalle)                                          | 4 (dashboard + CVE + assets/exploits/chain + sub-detail)                                                |
| Efectos WOW             | 7 (glow, particles, radar, shake, count-up, gradient, lines) | 12 (terrain, fuego, radar, helix, heatmap, bubbles, sankey, cascade, count-up, ssvc tree, morph, skull) |
| Acciones directas       | 4 (investigate, contain, ticket, export)                     | 5 (patch, ticket, escalate, accept risk, export)                                                        |
| Decision framework      | Manual                                                       | SSVC automatizado (Act/Attend/Track\*/Track)                                                            |

Este documento V2 es la referencia unica para construir la experiencia `/vulnerabilities` de CyberDemo.

---

_Documento generado como especificacion funcional completa para Vulnerability Intelligence Command Center_
_Referencia: ATTACK_SURFACE_WOW_DEFINITION.md (amenazas) como plantilla estructural_
_Fecha: 13 Febrero 2026_
