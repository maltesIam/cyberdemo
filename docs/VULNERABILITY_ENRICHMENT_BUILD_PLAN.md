# Plan de Construccion - Vulnerability Enrichment System

**Version:** 1.0
**Fecha:** 2026-02-16
**Documento funcional de referencia:** VULNERABILITY_ENRICHMENT_DESIGN.md
**Estado:** Pendiente de construccion

---

## 1. Resumen Ejecutivo

Este documento detalla el plan de construccion para el **Vulnerability Intelligence Command Center (Vuln WOW)** que enriquece CVEs con 12+ fuentes de inteligencia y proporciona 6 vistas visuales interactivas.

### Alcance

- Enriquecimiento de CVEs con 17 fuentes de inteligencia (APIs reales + generadores sinteticos)
- 6 vistas visuales (Risk Terrain, Calendar, Sunburst, Bubbles, DNA Helix, Sankey)
- Sistema SSVC de priorizacion automatizada
- 4 niveles de navegacion anidada
- Acciones operativas de remediacion
- Circuit Breaker y gestion robusta de errores
- Integracion MCP para llamadas desde agentes IA

---

## 2. Fuentes de Enriquecimiento a Implementar

### 2.1 Fuentes Existentes

| # | Fuente | Cliente Python | Estado |
|---|--------|----------------|--------|
| 1 | NVD (National Vulnerability Database) | `clients/nvd_client.py` | YA EXISTE |
| 2 | EPSS (Exploit Prediction Scoring) | `clients/epss_client.py` | YA EXISTE |

### 2.2 Fuentes Nuevas - Prioridad Alta

| # | Fuente | Cliente Python | Datos que aporta |
|---|--------|----------------|------------------|
| 3 | CISA KEV | `clients/kev_client.py` | is_kev, date_added, due_date, ransomware_use |
| 4 | ExploitDB | `clients/exploitdb_client.py` | exploit_id, type, platform, verified |
| 5 | GitHub Security Advisories | `clients/ghsa_client.py` | ghsa_id, vulnerable_versions, patched_versions |
| 6 | OSV (Open Source Vulnerabilities) | `clients/osv_client.py` | affected_packages, ranges, ecosystem |

### 2.3 Fuentes Nuevas - Prioridad Media

| # | Fuente | Cliente Python | Datos que aporta |
|---|--------|----------------|------------------|
| 7 | VulnCheck KEV+ | `clients/vulncheck_client.py` | vulncheck_kev_exploits, countermeasures |
| 8 | Shodan | `clients/shodan_vuln_client.py` | internet_exposed_count, countries |
| 9 | Nuclei Templates | `clients/nuclei_client.py` | has_template, template_id, severity |
| 10 | CVE Details | `clients/cve_details_client.py` | CVSS history, EPSS scores, estadisticas |

### 2.4 Plataformas Open Source (Self-Hosted)

| # | Fuente | Integracion | Datos que aporta |
|---|--------|-------------|------------------|
| 11 | DefectDojo | `clients/defectdojo_client.py` | Vulnerability aggregation, CISA KEV integration |

### 2.5 Fuentes Calculadas Localmente

| # | Fuente | Modulo | Datos que aporta |
|---|--------|--------|------------------|
| 12 | SSVC Calculator | `services/ssvc_calculator.py` | ssvc_decision, exploitation, automatable |
| 13 | Vendor Advisories | `clients/vendor_advisory_client.py` | vendor, patch_url, workaround |
| 14 | MITRE ATT&CK Mapping | `clients/mitre_cve_mapper.py` | mitre_techniques, tactics, actors |

### 2.6 Generadores Sinteticos (Fallback y Simulacion)

| # | Fuente | Modulo | Datos que aporta |
|---|--------|--------|------------------|
| 15 | Recorded Future Mock | `generators/recorded_future_mock.py` | risk_score, threat_actors, campaigns |
| 16 | Tenable VPR Mock | `generators/tenable_mock.py` | vpr_score, vpr_components |
| 17 | Qualys QDS Mock | `generators/qualys_mock.py` | qds_score, threat_indicators |

### 2.7 MCP Servers para Integracion

| # | MCP Server | GitHub | Herramientas |
|---|------------|--------|--------------|
| - | Vulnebify MCP | [PulseMCP/vulnebify](https://www.pulsemcp.com/servers/vulnebify) | Vulnerability scanning tools |
| - | Snyk MCP | Varios | Security scanning, vulnerability detection |

---

## 3. Modelo de Datos

### 3.1 Entidad Principal: EnrichedCVE

Implementar la clase completa definida en VULNERABILITY_ENRICHMENT_DESIGN.md seccion 6.1:

```python
# backend/src/models/enriched_cve.py

class EnrichedCVE:
    # --- Core (NVD) ---
    cve_id: str
    title: str
    description: str
    published_date: datetime
    last_modified_date: datetime

    # --- Scoring ---
    cvss_v3_score: float
    cvss_v3_vector: str
    cvss_v2_score: Optional[float]
    epss_score: float
    epss_percentile: float
    risk_score: float  # 0-100 compuesto

    # --- Classification ---
    severity: Literal["Critical", "High", "Medium", "Low"]
    cwe_ids: List[str]
    cwe_names: List[str]
    cpe_uris: List[str]

    # --- KEV (CISA) ---
    is_kev: bool
    kev_date_added: Optional[datetime]
    kev_due_date: Optional[datetime]
    kev_required_action: Optional[str]
    kev_ransomware_use: bool

    # --- Exploit Intelligence ---
    exploit_count: int
    exploit_sources: List[ExploitRef]
    exploit_maturity: Literal["weaponized", "poc", "unproven", "none"]
    has_nuclei_template: bool
    nuclei_template_id: Optional[str]

    # --- SSVC Decision ---
    ssvc_decision: Literal["Act", "Attend", "Track*", "Track"]
    ssvc_exploitation: Literal["active", "poc", "none"]
    ssvc_automatable: bool
    ssvc_technical_impact: Literal["total", "partial"]
    ssvc_mission_prevalence: Literal["essential", "supportive", "minimal"]

    # --- Open Source Context ---
    affected_packages: List[PackageRef]
    patched_versions: List[str]
    vulnerable_ranges: List[str]
    ecosystems: List[str]

    # --- Internet Exposure (Shodan) ---
    shodan_exposed_count: int
    shodan_countries: List[str]
    shodan_top_ports: List[int]

    # --- Vendor Patches ---
    vendor_advisories: List[VendorAdvisory]
    patch_available: bool
    patch_url: Optional[str]
    workaround_available: bool
    product_eol: bool

    # --- ATT&CK Context ---
    mitre_techniques: List[str]
    mitre_tactics: List[str]
    typical_actors: List[str]

    # --- Threat Intel ---
    threat_actors: List[ThreatActorRef]
    malware_families: List[str]
    campaigns: List[str]
    exploitation_activity: Literal["none", "low", "medium", "high", "critical"]
    trending: bool

    # --- Asset Impact (local) ---
    affected_asset_count: int
    affected_critical_assets: int
    affected_departments: List[str]

    # --- Lifecycle ---
    remediation_status: Literal["open", "in_progress", "remediated", "accepted_risk", "false_positive"]
    assigned_to: Optional[str]
    sla_due_date: Optional[datetime]
    sla_status: Literal["on_track", "at_risk", "overdue"]
    ticket_id: Optional[str]

    # --- Enrichment Metadata ---
    enrichment_level: Literal["basic", "partial", "rich", "full"]
    enrichment_sources: List[str]
    last_enriched_at: datetime
```

### 3.2 Subentidades

Implementar todas las subentidades del documento funcional seccion 6.2:

```python
class ExploitRef:
    source: str  # "exploitdb" | "metasploit" | "github_poc" | "nuclei"
    exploit_id: str
    title: str
    type: str  # "remote" | "local" | "webapps" | "dos"
    platform: str
    verified: bool
    url: str
    date_published: datetime

class PackageRef:
    ecosystem: str  # "npm" | "pip" | "maven" | "go" | "cargo"
    package_name: str
    vulnerable_versions: str
    patched_version: str
    ghsa_id: Optional[str]

class VendorAdvisory:
    vendor: str
    advisory_id: str
    patch_url: str
    patch_date: datetime
    workaround: Optional[str]
    severity_vendor: str

class ThreatActorRef:
    name: str
    aliases: List[str]
    country: str
    motivation: str
    sophistication: str

class AffectedAsset:
    asset_id: str
    hostname: str
    ip: str
    asset_type: str
    criticality: str
    department: str
    installed_version: str
    patched: bool
    last_scanned: datetime
```

---

## 4. Base de Datos

### 4.1 Tabla Principal: vulnerability_enrichment

```sql
CREATE TABLE vulnerability_enrichment (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    cve_id VARCHAR(50) NOT NULL UNIQUE,

    -- Core
    title VARCHAR(500),
    description TEXT,
    published_date TIMESTAMP,
    last_modified_date TIMESTAMP,

    -- Scoring
    cvss_v3_score FLOAT,
    cvss_v3_vector VARCHAR(100),
    cvss_v2_score FLOAT,
    epss_score FLOAT,
    epss_percentile FLOAT,
    risk_score FLOAT,

    -- Classification
    severity VARCHAR(20),
    cwe_ids TEXT[],
    cwe_names TEXT[],
    cpe_uris TEXT[],

    -- KEV
    is_kev BOOLEAN DEFAULT FALSE,
    kev_date_added TIMESTAMP,
    kev_due_date TIMESTAMP,
    kev_required_action TEXT,
    kev_ransomware_use BOOLEAN DEFAULT FALSE,

    -- Exploit Intelligence
    exploit_count INTEGER DEFAULT 0,
    exploit_sources JSONB,
    exploit_maturity VARCHAR(20),
    has_nuclei_template BOOLEAN DEFAULT FALSE,
    nuclei_template_id VARCHAR(100),

    -- SSVC
    ssvc_decision VARCHAR(20),
    ssvc_exploitation VARCHAR(20),
    ssvc_automatable BOOLEAN,
    ssvc_technical_impact VARCHAR(20),
    ssvc_mission_prevalence VARCHAR(20),

    -- Open Source
    affected_packages JSONB,
    patched_versions TEXT[],
    vulnerable_ranges TEXT[],
    ecosystems TEXT[],

    -- Internet Exposure
    shodan_exposed_count INTEGER DEFAULT 0,
    shodan_countries TEXT[],
    shodan_top_ports INTEGER[],

    -- Vendor
    vendor_advisories JSONB,
    patch_available BOOLEAN DEFAULT FALSE,
    patch_url VARCHAR(500),
    workaround_available BOOLEAN DEFAULT FALSE,
    product_eol BOOLEAN DEFAULT FALSE,

    -- ATT&CK
    mitre_techniques TEXT[],
    mitre_tactics TEXT[],
    typical_actors TEXT[],

    -- Threat Intel
    threat_actors JSONB,
    malware_families TEXT[],
    campaigns TEXT[],
    exploitation_activity VARCHAR(20),
    trending BOOLEAN DEFAULT FALSE,

    -- Asset Impact
    affected_asset_count INTEGER DEFAULT 0,
    affected_critical_assets INTEGER DEFAULT 0,
    affected_departments TEXT[],

    -- Lifecycle
    remediation_status VARCHAR(50),
    assigned_to VARCHAR(100),
    sla_due_date TIMESTAMP,
    sla_status VARCHAR(20),
    ticket_id VARCHAR(100),

    -- Enrichment Metadata
    enrichment_level VARCHAR(20),
    enrichment_sources TEXT[],
    last_enriched_at TIMESTAMP DEFAULT NOW(),

    -- Foreign key to existing ctem_findings
    FOREIGN KEY (cve_id) REFERENCES ctem_findings(cve_id) ON DELETE CASCADE
);

-- Indices
CREATE INDEX idx_vuln_cve_id ON vulnerability_enrichment(cve_id);
CREATE INDEX idx_vuln_severity ON vulnerability_enrichment(severity);
CREATE INDEX idx_vuln_risk_score ON vulnerability_enrichment(risk_score DESC);
CREATE INDEX idx_vuln_is_kev ON vulnerability_enrichment(is_kev);
CREATE INDEX idx_vuln_ssvc ON vulnerability_enrichment(ssvc_decision);
CREATE INDEX idx_vuln_epss ON vulnerability_enrichment(epss_score DESC);
CREATE INDEX idx_vuln_exploit_count ON vulnerability_enrichment(exploit_count DESC);
```

### 4.2 Tabla de Jobs

```sql
CREATE TABLE vulnerability_enrichment_jobs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    status VARCHAR(50) NOT NULL,
    total_items INTEGER NOT NULL,
    processed_items INTEGER DEFAULT 0,
    failed_items INTEGER DEFAULT 0,
    started_at TIMESTAMP DEFAULT NOW(),
    completed_at TIMESTAMP,
    error_message TEXT,
    metadata JSONB
);
```

---

## 5. Endpoints de API

### 5.1 Endpoints de Enriquecimiento

| Endpoint | Metodo | Descripcion |
|----------|--------|-------------|
| `/api/enrichment/vulnerabilities` | POST | Iniciar enriquecimiento |
| `/api/enrichment/vulnerabilities/status/{job_id}` | GET | Estado del job |

### 5.2 Endpoints de CVEs Enriquecidos

| Endpoint | Metodo | Descripcion |
|----------|--------|-------------|
| `/api/vulnerabilities/enriched` | GET | CVEs enriquecidos (paginado, filtros) |
| `/api/vulnerabilities/enriched/{cve_id}` | GET | Detalle completo |
| `/api/vulnerabilities/enriched/{cve_id}/assets` | GET | Assets afectados |
| `/api/vulnerabilities/enriched/{cve_id}/exploits` | GET | Exploits conocidos |
| `/api/vulnerabilities/enriched/{cve_id}/chain` | GET | Cadena de ataque |
| `/api/vulnerabilities/enriched/{cve_id}/enrich` | POST | Trigger enriquecimiento |

### 5.3 Endpoints de Visualizacion

| Endpoint | Metodo | Descripcion |
|----------|--------|-------------|
| `/api/vulnerabilities/overview` | GET | KPIs para Bottom Bar |
| `/api/vulnerabilities/terrain` | GET | Datos para Risk Terrain |
| `/api/vulnerabilities/heatmap` | GET | Datos para Calendar Heatmap |
| `/api/vulnerabilities/sunburst` | GET | Datos para CWE Sunburst |
| `/api/vulnerabilities/bubbles` | GET | Datos para Priority Bubbles |
| `/api/vulnerabilities/trends` | GET | Tendencias temporales |

### 5.4 Endpoints SSVC

| Endpoint | Metodo | Descripcion |
|----------|--------|-------------|
| `/api/vulnerabilities/ssvc/summary` | GET | Distribucion de decisiones |
| `/api/vulnerabilities/ssvc/tree` | GET | Arbol de decision con datos |

### 5.5 Endpoints de Clasificacion

| Endpoint | Metodo | Descripcion |
|----------|--------|-------------|
| `/api/vulnerabilities/cwes` | GET | Lista de CWEs con stats |
| `/api/vulnerabilities/cwes/{cwe_id}` | GET | Detalle CWE |
| `/api/vulnerabilities/packages` | GET | Paquetes vulnerables |

### 5.6 Endpoints de Remediacion

| Endpoint | Metodo | Descripcion |
|----------|--------|-------------|
| `/api/vulnerabilities/remediation/stats` | GET | Estadisticas de remediacion |
| `/api/vulnerabilities/remediation/flow` | GET | Datos para Sankey |

---

## 6. Servicios de Backend

### 6.1 VulnerabilityEnrichmentService

```python
# backend/src/services/vulnerability_enrichment_service.py

class VulnerabilityEnrichmentService:
    MAX_ITEMS_PER_SOURCE = 100

    async def enrich_vulnerabilities(
        self,
        cve_ids: List[str] = None,
        sources: List[str] = None,
        force_refresh: bool = False
    ) -> dict

    async def enrich_single_cve(
        self,
        cve_id: str,
        sources: List[str] = None
    ) -> EnrichedCVE
```

### 6.2 Risk Score Calculator

Implementar el algoritmo de VULNERABILITY_ENRICHMENT_DESIGN.md seccion 14.2:

```python
def calculate_risk_score(finding: dict) -> float:
    """
    Pesos:
    - CVSS Score (25%)
    - EPSS Score (25%)
    - KEV Status (15%)
    - Exploit Maturity (15%)
    - Asset Impact (10%)
    - Exposure (10%)
    """
```

### 6.3 SSVC Calculator

Implementar el algoritmo de VULNERABILITY_ENRICHMENT_DESIGN.md seccion 14.3:

```python
def calculate_ssvc_decision(finding: dict) -> str:
    """
    Decision tree:
    1. Is exploitation active? (KEV or EPSS > 70%)
       -> Is it automatable? -> Act/Attend
    2. Is there a PoC?
       -> Technical impact total? -> Attend/Track*
    3. No exploitation -> Track
    """
```

### 6.4 Circuit Breaker Pattern

Implementar proteccion contra APIs fallidas:

```python
# backend/src/services/circuit_breaker.py
from datetime import datetime, timedelta
from enum import Enum

class CircuitState(Enum):
    CLOSED = "closed"  # Funcionando normal
    OPEN = "open"      # Bloqueado por fallos
    HALF_OPEN = "half_open"  # Probando recuperaciÃ³n

class CircuitBreaker:
    def __init__(self, failure_threshold: int = 5, timeout_seconds: int = 60):
        self.failure_threshold = failure_threshold
        self.timeout = timedelta(seconds=timeout_seconds)
        self.failures = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED

    async def call(self, func, *args, **kwargs):
        """Ejecuta funciÃ³n con circuit breaker protection"""
        if self.state == CircuitState.OPEN:
            if datetime.utcnow() - self.last_failure_time > self.timeout:
                self.state = CircuitState.HALF_OPEN
            else:
                raise CircuitBreakerOpenError(f"Circuit breaker is OPEN, skipping call")

        try:
            result = await func(*args, **kwargs)
            self._on_success()
            return result
        except Exception as e:
            self._on_failure()
            raise

    def _on_success(self):
        self.failures = 0
        self.state = CircuitState.CLOSED

    def _on_failure(self):
        self.failures += 1
        self.last_failure_time = datetime.utcnow()
        if self.failures >= self.failure_threshold:
            self.state = CircuitState.OPEN
```

### 6.5 Limitacion de Items y Resiliencia

```python
# backend/src/services/vulnerability_enrichment_service.py

MAX_ITEMS_PER_SOURCE = 100

class VulnerabilityEnrichmentService:
    async def enrich_vulnerabilities(
        self,
        cve_ids: list[str] = None,
        sources: list[str] = None,
        force_refresh: bool = False
    ) -> dict:
        # Si no se especifican CVEs, obtener de DB (limitado a 100)
        if not cve_ids:
            cve_ids = await self._get_pending_cves(limit=MAX_ITEMS_PER_SOURCE)

        # Limitar a 100 items mÃ¡ximo
        cve_ids = cve_ids[:MAX_ITEMS_PER_SOURCE]

        results = {
            "total_items": len(cve_ids),
            "sources": {},
            "errors": []
        }

        # Enriquecer por fuente de forma independiente (NO FALLAR)
        for source in available_sources:
            try:
                enriched = await self._enrich_from_source(source, cve_ids, force_refresh)
                results["sources"][source] = {
                    "status": "success",
                    "enriched_count": enriched["count"]
                }
            except Exception as e:
                # NO FALLAR - registrar error y continuar
                results["sources"][source] = {
                    "status": "failed",
                    "error": str(e)
                }
                results["errors"].append({
                    "source": source,
                    "error": str(e),
                    "recoverable": True
                })

        return results
```

---

## 7. Generadores de Datos

### 7.1 Recorded Future Mock (Risk Score)

```python
# backend/src/generators/enrichment/recorded_future_mock.py
import random
from datetime import datetime, timedelta

class RecordedFutureMock:
    """Simula la API de Recorded Future para vulnerability risk scoring"""

    def calculate_risk_score(self, cve_id: str, cvss_score: float, epss_score: float,
                            known_exploited: bool, age_days: int) -> dict:
        """
        Calcula un risk score sintÃ©tico basado en mÃºltiples factores
        Risk Score: 0-100 donde 100 es el riesgo mÃ¡s alto

        Factores:
        - CVSS score (40% peso)
        - EPSS score (30% peso)
        - Known exploited (20% peso)
        - Age/freshness (10% peso) - mÃ¡s reciente = mÃ¡s riesgo
        """
        # Base score from CVSS (0-10 -> 0-40)
        cvss_component = (cvss_score / 10.0) * 40

        # EPSS component (0-1 -> 0-30)
        epss_component = epss_score * 30

        # Known exploited component (0 or 20)
        exploit_component = 20 if known_exploited else 0

        # Age component (newer is riskier)
        if age_days <= 30:
            age_component = 10
        elif age_days <= 90:
            age_component = 7
        elif age_days <= 365:
            age_component = 4
        else:
            age_component = 2

        risk_score = int(cvss_component + epss_component + exploit_component + age_component)
        risk_score = min(100, max(0, risk_score))

        # CategorÃ­a de riesgo
        if risk_score >= 90:
            risk_category = "Critical"
        elif risk_score >= 70:
            risk_category = "High"
        elif risk_score >= 50:
            risk_category = "Medium"
        else:
            risk_category = "Low"

        # Generar threat actors asociados
        threat_actors = self._generate_threat_actors(risk_score, known_exploited)

        # Generar campaigns asociadas
        campaigns = self._generate_campaigns(risk_score, age_days)

        return {
            "risk_score": risk_score,
            "risk_category": risk_category,
            "threat_actors": threat_actors,
            "campaigns": campaigns,
            "risk_vector": {
                "cvss_component": round(cvss_component, 2),
                "epss_component": round(epss_component, 2),
                "exploit_component": exploit_component,
                "age_component": age_component
            },
            "enrichment_source": "synthetic_recorded_future",
            "generated_at": datetime.utcnow().isoformat()
        }

    def _generate_threat_actors(self, risk_score: int, known_exploited: bool) -> list:
        high_sophistication_apts = [
            "APT28", "APT29", "APT41", "Lazarus Group", "FIN7", "Carbanak"
        ]
        medium_sophistication_apts = [
            "TA505", "TA551", "Cobalt Group", "Wizard Spider", "FIN8"
        ]

        if risk_score >= 80 and known_exploited:
            return random.sample(high_sophistication_apts, random.randint(1, 3))
        elif risk_score >= 60:
            return random.sample(medium_sophistication_apts, random.randint(1, 2))
        elif risk_score >= 40:
            return random.sample(medium_sophistication_apts, random.randint(0, 1))
        else:
            return []

    def _generate_campaigns(self, risk_score: int, age_days: int) -> list:
        adjectives = ["Silent", "Dark", "Hidden", "Persistent", "Advanced"]
        nouns = ["Phoenix", "Dragon", "Eagle", "Wolf", "Serpent"]

        campaigns = []
        if age_days <= 90 and risk_score >= 70:
            num_campaigns = random.randint(1, 2)
            for _ in range(num_campaigns):
                campaign_name = f"Operation {random.choice(adjectives)} {random.choice(nouns)}"
                campaigns.append(campaign_name)
        return campaigns
```

### 7.2 Tenable VPR Mock

```python
# backend/src/generators/enrichment/tenable_mock.py

class TenableVPRMock:
    """Simula Tenable Vulnerability Priority Rating (VPR)"""

    def calculate_vpr(self, cvss_score: float, epss_score: float,
                     asset_criticality: str, known_exploited: bool,
                     age_days: int, product_coverage: float) -> dict:
        """
        VPR Score: 0.0 - 10.0

        Factores:
        - CVSS (35%)
        - Threat (EPSS + exploited) (35%)
        - Asset criticality (20%)
        - Product coverage (10%)
        """
        # CVSS component (0-10 -> 0-3.5)
        cvss_component = (cvss_score / 10.0) * 3.5

        # Threat component (0-3.5)
        threat_base = epss_score * 2.5
        threat_exploit = 1.0 if known_exploited else 0
        threat_component = min(3.5, threat_base + threat_exploit)

        # Asset criticality component (0-2.0)
        criticality_map = {
            "critical": 2.0,
            "high": 1.5,
            "medium": 1.0,
            "low": 0.5
        }
        criticality_component = criticality_map.get(asset_criticality.lower(), 1.0)

        # Product coverage component (0-1.0)
        coverage_component = product_coverage * 1.0

        vpr_score = cvss_component + threat_component + criticality_component + coverage_component
        vpr_score = min(10.0, max(0.0, vpr_score))

        return {
            "vpr_score": round(vpr_score, 1),
            "vpr_components": {
                "cvss": round(cvss_component, 2),
                "threat": round(threat_component, 2),
                "asset_criticality": round(criticality_component, 2),
                "product_coverage": round(coverage_component, 2)
            },
            "enrichment_source": "synthetic_tenable",
            "generated_at": datetime.utcnow().isoformat()
        }
```

### 7.3 Qualys QDS Mock

```python
# backend/src/generators/enrichment/qualys_mock.py

class QualysQDSMock:
    """Simula Qualys Detection Score (QDS)"""

    def calculate_qds(self, cvss_score: float, epss_score: float,
                      known_exploited: bool, malware_associated: bool,
                      real_time_threat: bool) -> dict:
        """
        QDS Score: 0-100

        Factores:
        - CVSS base (40%)
        - EPSS/Exploitation (30%)
        - Threat indicators (30%)
        """
        # Base from CVSS
        cvss_component = (cvss_score / 10.0) * 40

        # Exploitation component
        epss_component = epss_score * 20
        exploit_bonus = 10 if known_exploited else 0

        # Threat indicators
        threat_score = 0
        if malware_associated:
            threat_score += 15
        if real_time_threat:
            threat_score += 15

        qds_score = int(cvss_component + epss_component + exploit_bonus + threat_score)
        qds_score = min(100, max(0, qds_score))

        return {
            "qds_score": qds_score,
            "qds_severity": "Critical" if qds_score >= 90 else "High" if qds_score >= 70 else "Medium" if qds_score >= 40 else "Low",
            "threat_indicators": {
                "malware_associated": malware_associated,
                "real_time_threat": real_time_threat,
                "known_exploited": known_exploited
            },
            "enrichment_source": "synthetic_qualys",
            "generated_at": datetime.utcnow().isoformat()
        }
```

### 7.4 Extension de gen_ctem.py

Extender el generador existente con los campos nuevos definidos en VULNERABILITY_ENRICHMENT_DESIGN.md seccion 14.1:

```python
# Campos nuevos a anadir
extended_finding = {
    # Existentes
    "cve_id": "CVE-2024-XXXXX",
    "cvss_score": 9.8,
    # ...

    # Nuevos: EPSS
    "epss_score": 0.972,
    "epss_percentile": 0.997,

    # Nuevos: KEV
    "is_kev": True,
    "kev_date_added": "2024-02-09",
    "kev_due_date": "2024-02-16",
    "kev_ransomware_use": True,

    # Nuevos: Exploit
    "exploit_count": 7,
    "exploit_maturity": "weaponized",
    "exploit_sources": [...],

    # Nuevos: SSVC
    "ssvc_decision": "Act",
    "ssvc_exploitation": "active",
    "ssvc_automatable": True,

    # ... resto de campos
}
```

---

## 8. Frontend

### 8.1 Layout Principal

Implementar el layout definido en VULNERABILITY_ENRICHMENT_DESIGN.md seccion 3.1:

```
+============================================================================+
| HEADER BAR                                                                  |
| [Bug Icon] Vulnerability Intelligence    [Search CVE...] [Presets] [Export]|
+============================================================================+
|        |                                                                    |
| RISK   |                     CANVAS CENTRAL                                 |
| PANEL  |   (Vista activa: Terrain/Calendar/Sunburst/Bubbles/DNA/Sankey)    |
| (left) |                                                                    |
|        |                                                    CVE DETAIL     |
| FILTER |                                                    PANEL (right)   |
| STACK  |                                                                    |
+--------+--------------------------------------------------------------------+
| BOTTOM BAR - KPIs + Remediation Progress                                    |
+============================================================================+
```

### 8.2 Paginas a Implementar

| Ruta | Componente | Nivel |
|------|------------|-------|
| `/vulnerabilities` | VulnerabilityDashboard | 1 |
| `/vulnerabilities/cves/:cveId` | CVEDetail | 2 |
| `/vulnerabilities/cves/:cveId/assets` | CVEAssets | 3 |
| `/vulnerabilities/cves/:cveId/exploits` | CVEExploits | 3 |
| `/vulnerabilities/cves/:cveId/chain` | CVEChain | 3 |
| `/vulnerabilities/cwes/:cweId` | CWEDetail | 2 |
| `/vulnerabilities/packages/:ecosystem/:name` | PackageDetail | 2 |
| `/vulnerabilities/ssvc` | SSVCDashboard | 2 |
| `/vulnerabilities/remediation` | RemediationFlow | 2 |
| `/vulnerabilities/trends` | VulnTrends | 2 |

### 8.3 Vistas Visuales (6 Modos)

| Vista | Nombre | Componente | Libreria |
|-------|--------|------------|----------|
| A | Risk Terrain | RiskTerrainCanvas | CSS 3D + Canvas |
| B | Vulnerability Calendar | VulnCalendarHeatmap | D3 cal-heatmap |
| C | CWE Sunburst | CWESunburst | D3 sunburst |
| D | Priority Bubbles | PriorityBubbles | D3-force |
| E | Exploit DNA Helix | ExploitDNAHelix | SVG + CSS |
| F | Remediation Flow | RemediationSankey | D3-sankey |

### 8.4 Componentes de Panel

| Componente | Descripcion |
|------------|-------------|
| RiskPanel | Sidebar izquierdo con filtros SSVC y stack |
| CVEDetailPanel | Sidebar derecho slide-in con detalle CVE |
| BottomBar | KPIs + Remediation Progress Bar |
| ViewSelector | Tabs para cambiar entre vistas |

### 8.5 Efectos WOW a Implementar

| Efecto | Donde | Como |
|--------|-------|------|
| Terrain Elevation | Vista A | Montanas CSS 3D, altura = CVSS, color = EPSS |
| Fuego animado | CVEs KEV | SVG animado con 3 capas de llamas |
| Radar de riesgo | CVE Detail | Chart radar 5 ejes con glow |
| DNA Helix rotation | Vista E | Doble helice SVG con nodos conectados |
| Heatmap pulse | Vista B | Celdas pulsantes en dias criticos |
| Bubble physics | Vista D | D3-force con gravedad por EPSS |
| Sankey flow | Vista F | Particulas fluyendo por los rios |
| Enrichment cascade | Al enriquecer | Badges iluminandose en secuencia |
| Count-up animado | Bottom Bar | Transicion numerica smooth |
| SSVC tree glow | Dashboard SSVC | Nodos con glow al hover |
| Exploit skull float | CVEs con exploit | Icon flotante con glow morado |

---

## 9. Risk Panel (Sidebar Izquierdo)

Implementar segun VULNERABILITY_ENRICHMENT_DESIGN.md seccion 10:

### 9.1 Secciones

1. **SSVC Filter**: Checkboxes Act/Attend/Track*/Track con counts
2. **Quick Filters**: KEV Only, Exploitable, Has Public Exploit, Patch Overdue
3. **Severity**: Critical/High/Medium/Low con counts
4. **Product/Vendor**: Buscador con lista
5. **Ecosystem**: npm/pip/maven/go checkboxes
6. **CWE Category**: Injection/Memory/Auth/XSS checkboxes
7. **Presets**: Urgent Triage, Patch Tuesday, Open Source Risk, etc.

### 9.2 Presets

| Preset | Filtros |
|--------|---------|
| Urgent Triage | SSVC=Act + KEV + EPSS>10% |
| Patch Tuesday | vendor=Microsoft + last 7 days |
| Open Source Risk | ecosystem != empty + exploit available |
| Internet Exposed | shodan_exposed > 0 + severity >= High |
| Compliance Review | SLA overdue + severity >= High |
| Zero Day Watch | patch_available=false + exploit_count > 0 |

---

## 10. CVE Detail Panel (Sidebar Derecho)

Implementar segun VULNERABILITY_ENRICHMENT_DESIGN.md seccion 9:

### 10.1 Secciones

1. **Header**: CVE-ID, controles (Pin, Expand, Close)
2. **Risk Profile**: CVSS bar, EPSS bar, KEV badge, SSVC decision, Risk Radar mini
3. **Description**: Texto con CWE links
4. **Enrichment Sources**: Grid de badges por fuente
5. **Affected Assets**: Lista con link a ver todos
6. **Exploits**: Lista con link a ver todos
7. **Attack Chain**: CWE -> T-code -> Actor con link
8. **Vendor Patches**: Advisory con download link
9. **Actions**: Create Ticket, Escalate, Accept Risk, Add Watchlist, Export

---

## 11. Bottom Bar (KPIs)

Implementar segun VULNERABILITY_ENRICHMENT_DESIGN.md seccion 11:

### 11.1 KPIs

| KPI | Formula | Flash |
|-----|---------|-------|
| Total CVEs | Count all | - |
| Critical | cvss >= 9.0 | Si sube |
| KEV | is_kev=true AND !remediated | Glow rojo |
| Exploitable | epss_score > 0.10 | - |
| Overdue | sla_status = "overdue" | Parpadeo rojo |
| SLA % | (on_track + remediated) / total | Rojo si < 85% |
| MTTR | avg(remediated_at - discovered_at) | - |

### 11.2 Remediation Progress Bar

- Barra segmentada: verde (remediated), azul (in_progress), gris (open)
- Selector temporal: 7d, 30d, 90d, All, Custom

---

## 12. Tests

### 12.1 Tests Unitarios

| Test | Archivo |
|------|---------|
| VulnerabilityEnrichmentService | `tests/unit/services/test_vuln_enrichment_service.py` |
| Risk Score Calculation | `tests/unit/services/test_vuln_risk_score.py` |
| SSVC Calculator | `tests/unit/services/test_ssvc_calculator.py` |
| KEV Client | `tests/unit/clients/test_kev_client.py` |
| ExploitDB Client | `tests/unit/clients/test_exploitdb_client.py` |
| GHSA Client | `tests/unit/clients/test_ghsa_client.py` |
| OSV Client | `tests/unit/clients/test_osv_client.py` |

### 12.2 Tests de Integracion

| Test | Archivo |
|------|---------|
| Endpoint enrich vulnerabilities | `tests/integration/test_vuln_enrichment_api.py` |
| Endpoint CVE detail | `tests/integration/test_cve_detail_api.py` |
| Endpoint terrain data | `tests/integration/test_vuln_terrain_api.py` |
| Endpoint SSVC | `tests/integration/test_ssvc_api.py` |

### 12.3 Tests E2E con Playwright

| Test | Archivo |
|------|---------|
| Boton enriquecimiento | `tests/e2e/vuln_enrichment.spec.ts` |
| Vista Risk Terrain | `tests/e2e/vuln_terrain.spec.ts` |
| Vista Calendar Heatmap | `tests/e2e/vuln_calendar.spec.ts` |
| Vista Priority Bubbles | `tests/e2e/vuln_bubbles.spec.ts` |
| CVE Detail Panel | `tests/e2e/cve_detail.spec.ts` |
| Navegacion anidada | `tests/e2e/vuln_navigation.spec.ts` |
| Filtros y presets | `tests/e2e/vuln_filters.spec.ts` |
| Error handling | `tests/e2e/vuln_error_handling.spec.ts` |

#### Tests E2E Detallados

```typescript
// tests/e2e/vuln_enrichment.spec.ts
import { test, expect } from "@playwright/test";

test.describe("Vulnerability Enrichment E2E", () => {
  test.beforeEach(async ({ page }) => {
    await page.goto("http://localhost:3000/vulnerabilities");
  });

  test("debe mostrar botÃ³n de enriquecer vulnerabilidades", async ({ page }) => {
    const vulnButton = page.getByRole("button", { name: /Enriquecer Vulnerabilidades/i });
    await expect(vulnButton).toBeVisible();
    await expect(vulnButton).toBeEnabled();
  });

  test("debe enriquecer vulnerabilidades con Ã©xito", async ({ page }) => {
    await page.getByRole("button", { name: /Enriquecer Vulnerabilidades/i }).click();

    // Debe mostrar spinner
    await expect(page.getByText(/Enriching\.\.\./i)).toBeVisible();

    // Esperar a completar (mÃ¡ximo 2 minutos)
    await expect(page.getByText(/Enriching\.\.\./i)).not.toBeVisible({ timeout: 120000 });

    // Debe mostrar mensaje de Ã©xito o warning
    const toast = page.locator('[role="alert"], .toast');
    await expect(toast).toBeVisible({ timeout: 5000 });
  });

  test("debe manejar error de fuente sin romper UI", async ({ page, context }) => {
    await context.route("**/api/enrichment/vulnerabilities", async (route) => {
      await route.fulfill({
        status: 200,
        body: JSON.stringify({
          job_id: "test-job-vuln",
          total_items: 50,
          successful_sources: 2,
          failed_sources: 2,
          sources: {
            nvd: { status: "success", enriched_count: 50 },
            epss: { status: "success", enriched_count: 50 },
            kev: { status: "failed", error: "API timeout" },
            exploitdb: { status: "failed", error: "Rate limit" },
          },
          errors: [
            { source: "kev", error: "API timeout", recoverable: true },
            { source: "exploitdb", error: "Rate limit", recoverable: true },
          ],
        }),
      });
    });

    await page.getByRole("button", { name: /Enriquecer Vulnerabilidades/i }).click();

    // Debe mostrar warning toast, NO error fatal
    const toast = page.locator('[role="alert"]');
    await expect(toast).toContainText(/source.*unavailable/i);

    // UI debe seguir funcional
    await expect(page.getByRole("button", { name: /Enriquecer Vulnerabilidades/i })).toBeEnabled();
  });

  test("debe limitar a 100 CVEs por fuente", async ({ page, context }) => {
    await context.route("**/api/enrichment/vulnerabilities", async (route) => {
      await route.fulfill({
        status: 200,
        body: JSON.stringify({
          job_id: "test-job-limit",
          total_items: 100, // DEBE SER 100, no mÃ¡s
          successful_sources: 4,
          failed_sources: 0,
        }),
      });
    });

    await page.getByRole("button", { name: /Enriquecer Vulnerabilidades/i }).click();

    const toast = page.locator('[role="alert"]');
    await expect(toast).toBeVisible({ timeout: 5000 });
  });

  test("debe mostrar datos enriquecidos en tabla", async ({ page }) => {
    // Enriquecer
    await page.getByRole("button", { name: /Enriquecer Vulnerabilidades/i }).click();
    await expect(page.getByText(/Enriching/i)).not.toBeVisible({ timeout: 120000 });

    // Verificar columnas de enriquecimiento
    await expect(page.getByText(/EPSS Score/i)).toBeVisible();
    await expect(page.getByText(/Risk Score/i)).toBeVisible();
    await expect(page.getByText(/SSVC/i)).toBeVisible();
  });
});

// tests/e2e/vuln_terrain.spec.ts
test.describe("Risk Terrain E2E", () => {
  test("debe cargar vista Risk Terrain", async ({ page }) => {
    await page.goto("http://localhost:3000/vulnerabilities");

    // Cambiar a vista terrain
    await page.getByRole("tab", { name: /terrain/i }).click();

    // Canvas debe cargar
    await expect(page.locator('.risk-terrain, canvas[class*="terrain"]')).toBeVisible({ timeout: 10000 });
  });

  test("debe mostrar montaÃ±as 3D con elevaciÃ³n por CVSS", async ({ page }) => {
    await page.goto("http://localhost:3000/vulnerabilities?view=terrain");

    // Debe haber elementos de terreno
    await expect(page.locator('.terrain-peak, .terrain-mountain')).toBeVisible();
  });
});

// tests/e2e/cve_detail.spec.ts
test.describe("CVE Detail Panel E2E", () => {
  test("debe abrir panel de detalle al click en CVE", async ({ page }) => {
    await page.goto("http://localhost:3000/vulnerabilities");

    // Click en un CVE de la lista
    const cveRow = page.locator('tr[data-cve-id], .cve-row').first();
    await cveRow.click();

    // Panel debe aparecer
    await expect(page.locator('.cve-detail-panel, [data-testid="cve-panel"]')).toBeVisible();
  });

  test("debe mostrar todas las secciones del CVE", async ({ page }) => {
    await page.goto("http://localhost:3000/vulnerabilities/cves/CVE-2024-0001");

    // Verificar secciones
    await expect(page.getByText(/Risk Profile/i)).toBeVisible();
    await expect(page.getByText(/Description/i)).toBeVisible();
    await expect(page.getByText(/Exploits/i)).toBeVisible();
    await expect(page.getByText(/Affected Assets/i)).toBeVisible();
  });
});
```

### 12.4 Tests de Performance

```python
# backend/tests/performance/test_vuln_enrichment_performance.py
import pytest
import time

@pytest.mark.performance
@pytest.mark.asyncio
async def test_vuln_enrichment_completes_within_2_minutes_for_100_cves():
    """Requisito: 100 CVEs en <2 minutos"""
    service = VulnerabilityEnrichmentService()
    cve_ids = [f"CVE-2024-{i:04d}" for i in range(100)]

    start = time.time()
    result = await service.enrich_vulnerabilities(cve_ids=cve_ids)
    duration = time.time() - start

    assert duration < 120  # 2 minutos
    assert result["total_items"] == 100

@pytest.mark.performance
@pytest.mark.asyncio
async def test_cache_improves_performance_by_80_percent():
    """Cache debe mejorar performance en 80%+"""
    service = VulnerabilityEnrichmentService()
    cve_id = "CVE-2024-0001"

    # Primera llamada (sin cache)
    start1 = time.time()
    await service._enrich_from_source('nvd', [cve_id], force_refresh=True)
    duration1 = time.time() - start1

    # Segunda llamada (con cache)
    start2 = time.time()
    await service._enrich_from_source('nvd', [cve_id], force_refresh=False)
    duration2 = time.time() - start2

    # Cache debe ser al menos 80% mÃ¡s rÃ¡pido
    speedup = (duration1 - duration2) / duration1
    assert speedup >= 0.80

@pytest.mark.performance
async def test_canvas_renders_at_60fps_with_5000_cves():
    """El canvas debe renderizar a 60fps con 5000 CVEs"""
    # Este test se ejecuta en Playwright
    pass
```

---

## 13. Cronograma de Implementacion

### Fase 1: Backend - Modelo y Clientes (5-6 dias)

- [ ] Crear modelo EnrichedCVE y subentidades
- [ ] Crear tabla vulnerability_enrichment en PostgreSQL
- [ ] Implementar KEV client
- [ ] Implementar ExploitDB client (o mock)
- [ ] Implementar GHSA client
- [ ] Implementar OSV client
- [ ] Implementar CVE Details client
- [ ] Implementar DefectDojo client (o mock)
- [ ] Tests unitarios para clientes

### Fase 1.5: Backend - Generadores Sinteticos (2-3 dias)

- [ ] Implementar RecordedFutureMock (risk score)
- [ ] Implementar TenableVPRMock
- [ ] Implementar QualysQDSMock
- [ ] Tests unitarios para generadores

### Fase 2: Backend - Services y Algoritmos (4-5 dias)

- [ ] Implementar VulnerabilityEnrichmentService
- [ ] Implementar Risk Score Calculator
- [ ] Implementar SSVC Calculator
- [ ] Implementar Circuit Breaker pattern
- [ ] Implementar limitacion de 100 items por fuente
- [ ] Implementar pipeline de enriquecimiento (Level 1/2/3)
- [ ] Tests unitarios para services

### Fase 3: Backend - Endpoints (4-5 dias)

- [ ] Endpoints de enriquecimiento
- [ ] Endpoints de CVEs enriquecidos con filtros
- [ ] Endpoints de visualizacion (terrain, heatmap, sunburst, bubbles)
- [ ] Endpoints SSVC
- [ ] Endpoints de remediacion
- [ ] Tests de integracion

### Fase 4: Frontend - Layout y Navegacion (3-4 dias)

- [ ] Layout principal con Header, Risk Panel, Canvas, Bottom Bar
- [ ] Sistema de rutas anidadas
- [ ] CVE Detail Panel slide-in
- [ ] View Selector con transiciones

### Fase 5: Frontend - Vistas Visuales (8-10 dias)

- [ ] Vista A: Risk Terrain con CSS 3D
- [ ] Vista B: Calendar Heatmap con D3
- [ ] Vista C: CWE Sunburst con D3
- [ ] Vista D: Priority Bubbles con D3-force
- [ ] Vista E: Exploit DNA Helix con SVG
- [ ] Vista F: Remediation Sankey con D3

### Fase 6: Frontend - Paneles y Efectos (4-5 dias)

- [ ] Risk Panel completo con filtros y presets
- [ ] CVE Detail Panel con todas las secciones
- [ ] Bottom Bar con KPIs y Progress
- [ ] Efectos WOW (fuego, glow, animations)

### Fase 7: Frontend - Paginas Anidadas (3-4 dias)

- [ ] CVEDetail page completa
- [ ] CVEAssets page
- [ ] CVEExploits page
- [ ] CVEChain page (grafo de ataque)
- [ ] SSVCDashboard con arbol interactivo

### Fase 8: Tests E2E y Polish (3-4 dias)

- [ ] Tests E2E completos
- [ ] Optimizacion de performance
- [ ] Responsive design
- [ ] Documentacion

### Fase 9: Integracion MCP (2-3 dias)

- [ ] Configurar Vulnebify MCP server
- [ ] Configurar Snyk MCP server (opcional)
- [ ] Implementar tools MCP propios (enrichment.vulnerabilities)
- [ ] Tests de integracion MCP
- [ ] Documentacion de uso desde agentes IA

**Total estimado: 38-49 dias**

---

## 14. Metricas de Exito

### 14.1 Funcionalidad

- [ ] 17 fuentes de enriquecimiento integradas (o simuladas)
- [ ] 6 vistas visuales conmutables
- [ ] 4 niveles de navegacion sin dead-ends
- [ ] SSVC decision automatizada funcional
- [ ] Acciones operativas (ticket, escalate, accept risk, export)

### 14.2 Cobertura de Enriquecimiento

- [ ] â‰¥95% de CVEs enriquecidos con CVSS
- [ ] â‰¥80% de CVEs enriquecidos con EPSS
- [ ] â‰¥70% de CVEs con exploit info
- [ ] â‰¥90% de CVEs con SSVC decision

### 14.3 Performance

- [ ] Canvas fluido (60fps) con 5000+ CVEs
- [ ] Cambio de vista < 500ms
- [ ] Enrichment Level 1 < 100ms
- [ ] Enrichment Level 2 < 2s
- [ ] Enriquecimiento de 100 CVEs < 2 minutos
- [ ] Cache hit rate >= 70%
- [ ] Filtros < 300ms
- [ ] Detail Panel < 200ms

### 14.4 Resiliencia y Error Handling

- [ ] âœ… LimitaciÃ³n a 100 items por fuente aplicada correctamente
- [ ] âœ… Fallo de 1 fuente NO bloquea enriquecimiento de otras
- [ ] âœ… UI nunca se rompe por errores de backend
- [ ] âœ… Circuit breaker previene hammering de APIs fallidas
- [ ] âœ… Fallback a datos sintÃ©ticos cuando APIs fallan
- [ ] âœ… Mensajes de error claros y accionables para el usuario

### 14.5 Cobertura de Tests

- [ ] â‰¥90% cobertura de cÃ³digo en backend (pytest)
- [ ] 100% de endpoints cubiertos con tests de integraciÃ³n
- [ ] 100% de flujos crÃ­ticos cubiertos con tests E2E Playwright
- [ ] â‰¥95% de tests funcionales completos PASAN

### 14.6 Efecto WOW

- [ ] Risk Terrain con montanas 3D y fuego en KEV
- [ ] DNA Helix con cadenas de explotacion
- [ ] Calendar Heatmap con pulso en dias criticos
- [ ] Priority Bubbles con fisica simulada
- [ ] Enrichment cascade visible
- [ ] Radar de riesgo multidimensional
- [ ] Sankey de remediacion con flujo animado

### 14.7 Valor Operativo

- [ ] Priorizacion SSVC (no solo CVSS)
- [ ] Contexto completo de CVE en < 3 clicks
- [ ] SLA tracking automatico
- [ ] Cadena de ataque visible

---

## 15. Documento de Resultados de Pruebas

Al finalizar la implementaciÃ³n, se crearÃ¡ el documento `VULNERABILITY_ENRICHMENT_TEST_RESULTS.md` con:

### Estructura del Documento

```markdown
# Resultados de Pruebas - Vulnerability Enrichment

## 1. Tests Unitarios Backend

### 1.1 VulnerabilityEnrichmentService
- [x] test_enrichment_limits_to_100_cves_per_source: PASS
- [x] test_enrichment_handles_source_failure_gracefully: PASS
- [x] test_circuit_breaker_opens_after_5_failures: PASS
- [x] test_risk_score_calculation: PASS
- [x] test_ssvc_calculation: PASS
- [ ] ... (todos los tests unitarios)

**Cobertura:** XX%
**Total tests:** XX
**Passed:** XX
**Failed:** 0

### 1.2 Generadores SintÃ©ticos
- [x] test_recorded_future_risk_score_high: PASS
- [x] test_recorded_future_risk_score_low: PASS
- [x] test_tenable_vpr_calculation: PASS
- [x] test_qualys_qds_calculation: PASS
- [ ] ... (todos los tests de generadores)

## 2. Tests de IntegraciÃ³n Backend
- [x] test_enrich_vulnerabilities_endpoint: PASS
- [x] test_cve_detail_endpoint: PASS
- [x] test_terrain_data_endpoint: PASS
- [x] test_ssvc_endpoint: PASS
- [ ] ... (todos los tests de integraciÃ³n)

## 3. Tests E2E Playwright

### 3.1 Enrichment
- [x] debe mostrar botÃ³n de enriquecer: PASS
- [x] debe enriquecer con Ã©xito: PASS
- [x] debe manejar error de fuente sin romper UI: PASS
- [x] debe limitar a 100 CVEs por fuente: PASS

### 3.2 Vistas Visuales
- [x] Risk Terrain carga correctamente: PASS
- [x] Calendar Heatmap funcional: PASS
- [x] Priority Bubbles con fÃ­sica: PASS
- [x] Sankey flow animado: PASS

### 3.3 CVE Detail
- [x] Panel abre al click: PASS
- [x] Todas las secciones visibles: PASS
- [x] Actions funcionan: PASS

## 4. PRUEBAS FUNCIONALES COMPLETAS

### 4.1 Enriquecimiento End-to-End Completo
**Test:** Enriquecer 100 CVEs hasta visualizaciÃ³n
**Resultado:** âœ… PASS
**DuraciÃ³n:** XX segundos

### 4.2 Enriquecimiento con Fuentes Parcialmente Fallando
**Test:** Simular fallo de 2/4 fuentes
**Resultado:** âœ… PASS

### 4.3 Generadores SintÃ©ticos
**Test:** Validar calidad de datos
- CorrelaciÃ³n risk score vs (CVSS+EPSS): 0.87 (>0.8 requerido)
**Resultado:** âœ… PASS

### 4.4 SSVC Decision Tree
**Test:** Validar decisiones SSVC
**Resultado:** âœ… PASS

## 5. RESUMEN FINAL

### MÃ©tricas de Ã‰xito
- âœ… LimitaciÃ³n a 100 items: VERIFICADO
- âœ… Error handling sin romper UI: VERIFICADO
- âœ… Performance <2 min para 100 CVEs: VERIFICADO
- âœ… Cache speedup >80%: VERIFICADO
- âœ… SSVC decision correcta: VERIFICADO

### ConclusiÃ³n
ðŸŽ‰ **TODO CONSTRUIDO OK**
âœ… **ALL FUNCTIONAL TESTS PASS**
```

---

## 16. Referencias

- VULNERABILITY_ENRICHMENT_DESIGN.md (documento funcional completo)
- [NVD API](https://nvd.nist.gov/developers/vulnerabilities)
- [EPSS API](https://www.first.org/epss/)
- [CISA KEV](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)
- [ExploitDB](https://www.exploit-db.com/)
- [GitHub Security Advisories](https://github.com/advisories)
- [OSV.dev](https://osv.dev/)
- [SSVC](https://certcc.github.io/SSVC/)
- [CVE Details](https://www.cvedetails.com/)
- [VulnCheck](https://www.vulncheck.com/)
- [Shodan CVEDB](https://cvedb.shodan.io/)
- [DefectDojo](https://github.com/DefectDojo/django-DefectDojo)
- [Vulnebify MCP](https://www.pulsemcp.com/servers/vulnebify)
- [Best Open Source Vulnerability Management Tools](https://www.wiz.io/academy/vulnerability-management/oss-vulnerability-management-tools)

---

**Documento creado:** 2026-02-16
**Estado:** Plan de construccion aprobado
